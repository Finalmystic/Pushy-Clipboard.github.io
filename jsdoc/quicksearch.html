<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"alarm.js.html":{"id":"alarm.js.html","title":"Source: alarm.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: alarm.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Manage the chrome.alarm * @namespace */ app.Alarm = (function() { 'use strict'; new ExceptionHandler(); /** * Alarm for cleaning up old {@link ClipItem} objects * @type {string} * @const * @default * @private * @memberOf app.Alarm */ const ALARM_STORAGE = 'storage'; /** * Event: Fired when an alarm has elapsed. * @see https://developer.chrome.com/apps/alarms#event-onAlarm * @param {Object} alarm - details on alarm * @private * @memberOf app.Alarm */ function _onAlarm(alarm) { if (alarm.name === ALARM_STORAGE) { app.Alarm.deleteOldClipItems(); } } /** * Event: Fired when item in localStorage changes * @see https://developer.mozilla.org/en-US/docs/Web/Events/storage * @param {Event} event - storage event * @param {string} event.key - storage item that changed * @private * @memberOf app.Alarm */ function _onStorageChanged(event) { if (event.key === 'storageDuration') { app.Alarm.updateAlarms(); } } /** * Listen for alarms */ chrome.alarms.onAlarm.addListener(_onAlarm); /** * Listen for changes to localStorage */ addEventListener('storage', _onStorageChanged, false); return { /** * Set the repeating alarms * @memberOf app.Alarm */ updateAlarms: function() { const durationType = app.Utils.getInt('storageDuration'); if (durationType === 4) { // until room is needed chrome.alarms.clear(ALARM_STORAGE); } else { // Add daily alarm to delete old clipItems chrome.alarms.get(ALARM_STORAGE, (alarm) =&gt; { if (!alarm) { chrome.alarms.create(ALARM_STORAGE, { when: Date.now() + app.Utils.MILLIS_IN_DAY, periodInMinutes: app.Utils.MIN_IN_DAY, }); } }); } }, /** * Delete {@link ClipItem} objects older than the * storageDuration setting * @memberOf app.Alarm */ deleteOldClipItems: function() { app.ClipItem.deleteOld().catch((err) =&gt; { app.GA.error(err.message, 'Alarm.deleteOldClipItems'); }); }, }; })(); × Search results Close "},"clipboard.js.html":{"id":"clipboard.js.html","title":"Source: clipboard.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: clipboard.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Manage the clipboard * @namespace */ app.CB = (function() { 'use strict'; new ExceptionHandler(); /** * Delay time for reading from clipboard * @type {int} * @default * @private * @memberOf app.CB */ const WAIT_MILLIS = 250; /** * Send local {@link ClipItem} push notification if enabled * @param {ClipItem} clipItem - {@link ClipItem} to send * @private * @memberOf app.CB */ function _sendLocalClipItem(clipItem) { if (!clipItem.remote &amp;&amp; app.Utils.isAutoSend()) { // send to our devices app.Msg.sendClipItem(clipItem).catch((err) =&gt; { app.Gae.sendMessageFailed(err); }); } } /** * Add a new {@link ClipItem} from the Clipboard contents * @private * @memberOf app.CB */ function _addClipItemFromClipboard() { if (!app.Utils.isMonitorClipboard()) { return; } // wait a little to make sure clipboard is ready setTimeout(function() { // get the clipboard contents const text = app.CB.getTextFromClipboard(); if (app.Utils.isWhiteSpace(text)) { return; } // Persist app.ClipItem.add(text, Date.now(), false, false, app.Device.myName()).then((clipItem) =&gt; { // send to our devices _sendLocalClipItem(clipItem); return null; }).catch((err) =&gt; { app.GA.error(err.message, 'CB._addClipItemFromClipboard'); }); }, WAIT_MILLIS); } // noinspection JSUnusedLocalSymbols /** * Event: Fired when a message is sent from either an extension process&lt;br&gt; * (by runtime.sendMessage) or a content script (by tabs.sendMessage). * @see https://developer.chrome.com/extensions/runtime#event-onMessage * @param {Object} request - details for the message * @param {Object} sender - MessageSender object * @param {function} response - function to call once after processing * @returns {boolean} true if asynchronous * @private * @memberOf app.CB */ function _onChromeMessage(request, sender, response) { let ret = false; if (request.message === 'copiedToClipboard') { // we put data on the clipboard _addClipItemFromClipboard(); } else if (request.message === 'copyToClipboard') { // copy a ClipItem to the clipboard const clip = request.clipItem; const clipItem = new app.ClipItem(clip.text, clip.lastSeen, clip.fav, clip.remote, clip.device); app.CB.copyToClipboard(clipItem.text); _sendLocalClipItem(clipItem); } return ret; } /** * Listen for Chrome messages */ chrome.runtime.onMessage.addListener(_onChromeMessage); return { /** * Get the text from the clipboard * @returns {string} text from clipboard * @memberOf app.CB */ getTextFromClipboard: function() { const input = document.createElement('textArea'); document.body.appendChild(input); input.focus(); input.select(); document.execCommand('Paste'); const text = input.value; input.remove(); return text; }, /** * Copy the given text to the clipboard * @param {string} text - text to copy * @memberOf app.CB */ copyToClipboard: function(text) { const input = document.createElement('textArea'); document.body.appendChild(input); input.textContent = text; input.focus(); input.select(); document.execCommand('Copy'); input.remove(); }, }; })(); × Search results Close "},"devices.js.html":{"id":"devices.js.html","title":"Source: devices.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: devices.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * A list of remote {@link Device} objects we know about * @namespace */ app.Devices = (function() { 'use strict'; new ExceptionHandler(); /** * A Map of {@link Device} objects keyed by their unique names * @type {Map} * @memberOf app.Devices */ let _devices = new Map(); /** * Convert Map to Object * @param {Map} map - a Map * @returns {Object} as Object * @private * @memberOf app.Devices */ function _mapToObj(map) { let obj = Object.create(null); for (let [k, v] of map) { // We don’t escape the key '__proto__' // which can cause problems on older engines obj[k] = v; } return obj; } /** * Get the {@link Device} objects from localStorage * @private * @memberOf app.Devices */ function _load() { _devices = new Map(); const json = app.Utils.get('devices'); if (!json) { return; } for (let k in json) { if (json.hasOwnProperty(k)) { let v = json[k]; let device = new app.Device(v.model, v.sn, v.os, v.nickname, v.lastSeen); _devices.set(k, device); } } } /** * Save the {@link Device} objects to localStorage * @private * @memberOf app.Devices */ function _save() { app.Utils.set('devices', _mapToObj(_devices)); // let listeners know we changed chrome.runtime.sendMessage({ message: 'devicesChanged', }, (response) =&gt; {}); } /** * Event: called when document and resources are loaded&lt;br /&gt; * Load the {@link Device} objects from localStorage * @private * @memberOf app.Devices */ function _onLoad() { _load(); } // noinspection JSUnusedLocalSymbols /** * Event: Fired when a message is sent from either an extension process&lt;br&gt; * (by runtime.sendMessage) or a content script (by tabs.sendMessage). * @see https://developer.chrome.com/extensions/runtime#event-onMessage * @param {Object} request - details for the message * @param {Object} sender - MessageSender object * @param {function} response - function to call once after processing * @returns {boolean} true if asynchronous * @private * @memberOf app.Devices */ function _onChromeMessage(request, sender, response) { let ret = false; if (request.message === 'removeDevice') { app.Devices.removeByName(request.deviceName); } else if (request.message === 'ping') { app.Msg.sendPing().catch((err) =&gt; { app.Gae.sendMessageFailed(err); }); } return ret; } /** * listen for document and resources loaded */ window.addEventListener('load', _onLoad); /** * Listen for Chrome messages */ chrome.runtime.onMessage.addListener(_onChromeMessage); return { /** * Get an {@link Iterator} on the Devices * @returns {Iterator.&lt;Device&gt;} Iterator * @memberOf app.Devices */ entries: function() { return _devices.entries(); }, /** * Add a new {@link Device} * @param {Device} device - {@link Device} to add * @memberOf app.Devices */ add: function(device) { _devices.set(device.getUniqueName(), device); _save(); }, /** * Remove a {@link Device} * @param {Device} device - {@link Device} to remove * @memberOf app.Devices */ remove: function(device) { this.removeByName(device.getUniqueName()); }, /** * Remove a {@link Device} with the given unique name * @param {string} uniqueName - Name of Device to remove * @memberOf app.Devices */ removeByName: function(uniqueName) { _devices.delete(uniqueName); _save(); }, /** * Remove all {@link Device} objects * @memberOf app.Devices */ clear: function() { _devices.clear(); _save(); }, }; })(); × Search results Close "},"firebase.js.html":{"id":"firebase.js.html","title":"Source: firebase.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: firebase.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Manage interaction with firebase and its Namespaces * @see https://firebase.google.com/docs/web/setup * @namespace */ app.Fb = (function() { 'use strict'; new ExceptionHandler(); /** * Error message for regToken * @type {string} * @default * @memberOf app.Fb */ const ERROR_TOKEN = 'Failed to obtain messaging token.\\n'; /** * Firebase app * @private * @memberOf app.Fb */ let _app = null; /** * Firebase messaging Namespace * @private * @memberOf app.Fb */ let _messaging; /** * Firebase auth Namespace * @private * @memberOf app.Fb */ let _auth; /** * Initialize firebase and its Namespaces * @param {ServiceWorkerRegistration} swReg - use own ServiceWorker * @returns {Promise.&lt;void&gt;} void * @private * @memberOf app.Fb */ function _initializeFirebase(swReg) { const config = { apiKey: 'AIzaSyBzqx2gVefRo3tvMFGRFs9gztd081pRgVg', authDomain: 'clip-man.firebaseapp.com', databaseURL: 'https://clip-man.firebaseio.com', storageBucket: 'clip-man.appspot.com', messagingSenderId: '597467211507', }; return _deleteFirebaseApp().then(() =&gt; { _app = firebase.initializeApp(config); _auth = firebase.auth(); _messaging = firebase.messaging(); _messaging.useServiceWorker(swReg); // Callback fired if Instance ID token is updated. _messaging.onTokenRefresh(_refreshRegToken); return Promise.resolve(); }); } /** * Delete firebase.app if it exists * @returns {Promise.&lt;void&gt;} void * @private * @memberOf app.Fb */ function _deleteFirebaseApp() { if (_app) { return firebase.app().delete(); } else { return Promise.resolve(); } } /** * Refresh the regToken when firebase changes it * @private * @memberOf app.Fb */ function _refreshRegToken() { _messaging.getToken().then((refreshedToken) =&gt; { if (app.Utils.isSignedIn()) { return app.Reg.register(refreshedToken); } else { return Promise.resolve(); } }).catch((err) =&gt; { app.GA.error(err.message, 'Fb._refreshRegToken'); }); } return { /** * Initialize the firebase libraries * @param {ServiceWorkerRegistration} swReg - service worker * @returns {Promise&lt;void&gt;} void * @memberOf app.Fb */ initialize: function(swReg) { return _initializeFirebase(swReg); }, /** * SignIn to firebase * @param {string} token - token * @returns {Promise&lt;Object&gt;} The current firebase user * @memberOf app.Fb */ signIn: function(token) { return app.SW.initialize().then(() =&gt; { const credential = firebase.auth.GoogleAuthProvider.credential(null, token); // Authorize Firebase with the Google access token. return _auth.signInWithCredential(credential); }); }, /** * Unregister Service Worker and sign-out of firebase * @returns {Promise&lt;void&gt;} Error on reject * @memberOf app.Fb */ signOut: function() { return app.SW.unregister().then(() =&gt; { return _auth.signOut(); }); }, /** * Get the registration token for fcm * @returns {Promise&lt;token&gt;} A registration token for fcm * @memberOf app.Fb */ getRegToken: function() { return _messaging.getToken().then((token) =&gt; { if (token) { return Promise.resolve(token); } else { return Promise.reject(new Error(ERROR_TOKEN)); } }); }, }; })(); × Search results Close "},"analytics.js.html":{"id":"analytics.js.html","title":"Source: analytics.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: analytics.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Manage Google Analytics tracking * @namespace */ app.GA = (function() { 'use strict'; /** * Tracking ID * @type {string} * @const * @default * @private * @memberOf app.GA */ const TRACKING_ID = 'UA-61314754-3'; /** * Google Analytics Event * @typedef {Object} GAEvent * @property {string} eventCategory - category * @property {string} eventAction - action * @property {string} eventLabel - label * @property {boolean} noInteraction - direct user interaction? */ /** * Event types * @type {{}} * @property {GAEvent} INSTALLED - extension installed * @property {GAEvent} UPDATED - extension updated * @property {GAEvent} SENT - message sent * @property {GAEvent} RECEIVED - message received * @property {GAEvent} REGISTERED - {@link Device} registered * @property {GAEvent} UNREGISTERED - {@link Device} unregistered * @const * @memberOf app.GA */ const EVENT = { INSTALLED: { eventCategory: 'extension', eventAction: 'installed', eventLabel: '', noInteraction: false, }, UPDATED: { eventCategory: 'extension', eventAction: 'updated', eventLabel: '', noInteraction: true, }, MENU: { eventCategory: 'ui', eventAction: 'menuSelect', eventLabel: '', noInteraction: false, }, TOGGLE: { eventCategory: 'ui', eventAction: 'toggle', eventLabel: '', noInteraction: false, }, LINK: { eventCategory: 'ui', eventAction: 'linkSelect', eventLabel: '', noInteraction: false, }, TEXT: { eventCategory: 'ui', eventAction: 'textChanged', eventLabel: '', noInteraction: false, }, BUTTON: { eventCategory: 'ui', eventAction: 'buttonClicked', eventLabel: '', noInteraction: false, }, SENT: { eventCategory: 'message', eventAction: 'sent', eventLabel: '', noInteraction: false, }, RECEIVED: { eventCategory: 'message', eventAction: 'received', eventLabel: '', noInteraction: true, }, REGISTERED: { eventCategory: 'register', eventAction: 'registered', eventLabel: '', noInteraction: false, }, UNREGISTERED: { eventCategory: 'register', eventAction: 'unregistered', eventLabel: '', noInteraction: false, }, }; /** * Event: called when document and resources are loaded&lt;br /&gt; * Initialize Google Analytics * @private * @memberOf app.GA */ function _onLoad() { // Standard Google Universal Analytics code // noinspection OverlyComplexFunctionJS (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; // noinspection CommaExpressionJS i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }, i[r].l = 1 * new Date(); // noinspection CommaExpressionJS a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', TRACKING_ID, 'auto'); // see: http://stackoverflow.com/a/22152353/1958200 ga('set', 'checkProtocolTask', function() { }); ga('set', 'appName', 'Pushy'); ga('set', 'appId', 'pushy-chrome-extension'); ga('set', 'appVersion', app.Utils.getVersion()); ga('require', 'displayfeatures'); } // listen for document and resources loaded window.addEventListener('load', _onLoad); return { EVENT: EVENT, /** * Send a page * @param {string} page - page path * @memberOf app.GA */ page: function(page) { if (page) { ga('send', 'pageview', page); } }, /** * Send an event * @param {GAEvent} event - the event type * @param {?string} [label=null] - override label * @param {?string} [action=null] - override action * @memberOf app.GA */ event: function(event, label=null, action=null) { if (event) { // shallow copy const ev = JSON.parse(JSON.stringify(event)); ev.hitType = 'event'; ev.eventLabel = label ? label : ev.eventLabel; ev.eventAction = action ? action : ev.eventAction; ga('send', ev); } }, /** * Send an error * @param {?string} [label=null] - override label * @param {?string} [action=null] - override action * @memberOf app.GA */ error: function(label=null, action=null) { const ev = { eventCategory: 'error', eventAction: 'unknownMethod', eventLabel: '', noInteraction: true, }; ev.hitType = 'event'; ev.eventLabel = label ? label : ev.eventLabel; ev.eventAction = action ? action : ev.eventAction; ga('send', ev); }, /** * Send an exception * @param {string} message - the error message * @param {?string} [stack=null] - error stack * @memberOf app.GA */ exception: function(message, stack = null) { let msg = ''; if (message) { msg += message; } if (stack) { msg += `\\n${stack}`; } ga('send', 'exception', { 'exDescription': msg, 'exFatal': true, }); console.error(msg); }, }; })(); × Search results Close "},"gae.js.html":{"id":"gae.js.html","title":"Source: gae.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: gae.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Handle communication with Google App Engine server using Endpoints * @see https://cloud.google.com/appengine/docs/standard/java/endpoints/ * @namespace */ app.Gae = (function() { 'use strict'; new ExceptionHandler(); /** * Base path of real gae server * @const * @default * @private * @memberOf app.Gae */ const GAE_ROOT_REMOTE = 'https://clip-man.appspot.com/_ah/api'; // noinspection Eslint,JSUnusedLocalSymbols /** * Base path of local testing server * @const * @default * @private * @memberOf app.Gae */ // eslint-disable-next-line no-unused-vars const GAE_ROOT_LOCAL = 'http://localhost:8080/_ah/api'; // Set to GAE_ROOT_LOCAL for local testing const GAE_ROOT = GAE_ROOT_REMOTE; /** * Max retries on 500 errors * @const * @default * @private * @memberOf app.Gae */ const MAX_ATTEMPTS = 4; /** * Delay multiplier for exponential back-off * @const * @default * @private * @memberOf app.Gae */ const DELAY_TIME = 1000; const HEADER_AUTHORIZATION = 'Authorization'; const HEADER_CONTENT_TYPE = 'Content-Type'; const HEADER_ACCEPT = 'Accept'; const CONTENT_TYPE_JSON = 'application/json'; const ERROR_UNAUTHORIZED_USER = 'Unauthorized user'; /** * Retry call to Endpoint with new token * @param {string} url - server Endpoint * @param {string} token - authorization token * @returns {Promise.&lt;void&gt;} void * @private * @memberOf app.Gae */ function _retryPost(url, token) { return app.User.removeCachedAuthToken(token).then(() =&gt; { return app.User.getAuthToken(false); }).then((token) =&gt; { return app.Gae.doPost(url, token, false); }); } return { /** * Root path to our gae server * @type {string} * @memberOf app.Gae */ GAE_ROOT: GAE_ROOT, /** * Perform POST request to server using exponential back-off * @param {string} url - server Endpoint * @param {string} token - authorization token * @param {boolean} retryNewToken - if true, * retry with new token on error * @returns {Promise.&lt;void&gt;} void * @memberOf app.Gae */ doPost: function(url, token, retryNewToken = false) { const headers = { [HEADER_AUTHORIZATION]: `Bearer ${token}`, [HEADER_CONTENT_TYPE]: CONTENT_TYPE_JSON, [HEADER_ACCEPT]: CONTENT_TYPE_JSON, }; const init = { method: 'POST', headers: headers, }; let attempts = 0; return _fetch(url, init); /** * Fetch with exponential back-off * @param {string} url - server Endpoint * @param {Object} init - fetch options * @returns {Promise.&lt;void&gt;} void * @memberOf app.Gae */ function _fetch(url, init) { return fetch(url, init).then((response) =&gt; { if (response.ok) { return response.json(); } else if (retryNewToken &amp;&amp; (response.status === 401)) { // could be bad token. Remove cached one and try again return _retryPost(url, token); } else if ((attempts &lt; MAX_ATTEMPTS) &amp;&amp; ((response.status &gt;= 500) &amp;&amp; (response.status &lt; 600))) { // temporary network issue, retry with back-off attempts++; const delay = (Math.pow(2, attempts) - 1) * DELAY_TIME; // eslint-disable-next-line promise/avoid-new return new Promise(() =&gt; { setTimeout(() =&gt; { return _fetch(url, init); }, delay); }); } else { throw new Error('status: ' + response.status, '\\nreason: ' + response.statusText); } }).then((json) =&gt; { if (json.success) { return Promise.resolve(); } else if (retryNewToken &amp;&amp; (json.reason === ERROR_UNAUTHORIZED_USER)) { // could be bad token. Try with new one return _retryPost(url, token); } else { throw new Error(json.reason); } }); } }, /** * Convert text to JSON * @param {string} text - text to parse * @returns {JSON|null} parsed text, null if not valid JSON * @memberOf app.Gae */ getJSON: function(text) { let response; try { response = JSON.parse(text); } catch (ex) { response = null; } return response; }, /** * Notify listeners that send message failed * @param {Error} err - what caused the failure * @memberOf app.Gae */ sendMessageFailed: function(err) { app.GA.error(err, 'GAE.sendMessageFailed'); chrome.runtime.sendMessage({ message: 'sendMessageFailed', error: err.toString(), }, () =&gt; {}); }, }; })(); × Search results Close "},"messaging_client.js.html":{"id":"messaging_client.js.html","title":"Source: messaging_client.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: messaging_client.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Send messages to the gae server MessagingEndpoint for delivery * @namespace */ app.Msg = (function() { 'use strict'; new ExceptionHandler(); /** * Base path of MessagingEndpoint * @const * @private * @memberOf app.Msg */ const URL_BASE = `${app.Gae.GAE_ROOT}/messaging/v1/send/`; /** * Max message length. Server may reduce it more * @const * @default * @private * @memberOf app.Msg */ const MAX_MSG_LEN = 4096; /** * Message action * @type {{MESSAGE: string, * PING: string, * PING_RESPONSE: string, * DEVICE_ADDED: string, * DEVICE_REMOVED: string}} * @const * @default * @memberOf app.Msg */ const ACTION = { MESSAGE: 'm', PING: 'ping_others', PING_RESPONSE: 'respond_to_ping', DEVICE_ADDED: 'add_our_device', DEVICE_REMOVED: 'remove_our_device', }; /** * Message body * @type {{PING: string, * PING_RESPONSE: string, * DEVICE_ADDED: string, * DEVICE_REMOVED: string}} * @const * @default * @private * @memberOf app.Msg */ const BODY = { PING: 'Contacting other devices...', PING_RESPONSE: 'Device is online', DEVICE_ADDED: 'New device added', DEVICE_REMOVED: 'Device removed', }; /** * Data packet sent to server * @typedef {{}} GaeMsg * @property {string} act - type of message * @property {string} m - content of message * @property {string} dM - {@link Device} model * @property {string} dSN - {@link Device} serial number * @property {string} dOS - {@link Device} operating system * @property {string} dN - {@link Device} nickname * @property {string} fav - '1' if favorite item (optional) * @property {string} srcRegId - source of ping (optional) */ /** * Get the data packet we will send * @param {string} action - message type * @param {string} body - message body * @returns {GaeMsg} data packet * @private * @memberOf app.Msg */ function _getData(action, body) { const msg = _getDevice(); msg.act = action; msg.m = body; return msg; } /** * Get portion of {@link Device} sent in message * @returns {{}} Subset of {@link Device} info as object literal * @memberOf app.Msg */ function _getDevice() { return { [app.Device.MODEL]: app.Device.myModel(), [app.Device.SN]: app.Device.mySN(), [app.Device.OS]: app.Device.myOS(), [app.Device.NICKNAME]: app.Device.myNickname(), }; } /** * Send message to server for delivery to our {@link Devices} * @param {GaeMsg} data - data packet * @param {boolean} notify - display notification if true * @returns {Promise&lt;void&gt;} void * @private * @memberOf app.Msg */ function _sendMessage(data, notify) { if (!app.Utils.isSignedIn() || !app.Utils.allowPush()) { return Promise.resolve(); } let url; return app.Fb.getRegToken().then((regId) =&gt; { const json = encodeURIComponent(JSON.stringify(data)); const highPriority = app.Utils.get('highPriority'); url = `${URL_BASE}${regId}/${json}/${highPriority}`; return app.User.getAuthToken(true); }).then((token) =&gt; { return app.Gae.doPost(url, token, true); }).then(() =&gt; { if (notify &amp;&amp; app.Notify.onSend()) { app.Notify.create(app.Notify.NOTIFY_SEND, data); } app.GA.event(app.GA.EVENT.SENT); return Promise.resolve(); }); } return { ACTION: ACTION, /** * Send clipboard contents as represented by a {@link ClipItem} * @param {ClipItem} clipItem - contents of clipboard * @returns {Promise&lt;void&gt;} void * @memberOf app.Msg */ sendClipItem: function(clipItem) { if (app.Utils.isWhiteSpace(clipItem.text)) { return Promise.resolve(); } let text = clipItem.text; if (text.length &gt; MAX_MSG_LEN) { // limit message size. Server may limit more text = text.substring(0, MAX_MSG_LEN - 1); } const data = _getData(ACTION.MESSAGE, text); data.FAV = clipItem.fav ? '1' : '0'; return _sendMessage(data, true); }, /** * Send message for adding our {@link Device} * @returns {Promise&lt;void&gt;} void * @memberOf app.Msg */ sendDeviceAdded: function() { const data = _getData(ACTION.DEVICE_ADDED, BODY.DEVICE_ADDED); return _sendMessage(data, true); }, /** * Send message for removing our {@link Device} * @returns {Promise&lt;void&gt;} void * @memberOf app.Msg */ sendDeviceRemoved: function() { const data = _getData(ACTION.DEVICE_REMOVED, BODY.DEVICE_REMOVED); return _sendMessage(data, true); }, /** * Ping our {@link app.Devices} * @returns {Promise&lt;void&gt;} void * @memberOf app.Msg */ sendPing: function() { const data = _getData(ACTION.PING, BODY.PING); return _sendMessage(data, false); }, /** * Respond to a ping from one of our {@link app.Devices} * @param {string} srcRegId - source of ping * @returns {Promise&lt;void&gt;} void * @memberOf app.Msg */ sendPingResponse: function(srcRegId) { const data = _getData(ACTION.PING_RESPONSE, BODY.PING_RESPONSE); data.srcRegId = srcRegId; return _sendMessage(data, false); }, }; })(); × Search results Close "},"notify.js.html":{"id":"notify.js.html","title":"Source: notify.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: notify.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Handle display of notifications * @namespace */ app.Notify = (function() { 'use strict'; new ExceptionHandler(); /** * Send notification type * @type {string} * @default * @const * @private * @memberOf app.Notify */ const NOTIFY_SEND = 'CLIP_MAN_SEND'; /** * Icons * @type {{LOCAL_COPY: string, * ADD_DEVICE: string, * REMOVE_DEVICE: string}} * @const * @default * @private * @memberOf app.Notify */ const ICON = { LOCAL_COPY: '/images/ic_local_copy.png', ADD_DEVICE: '/images/ic_add_device.png', REMOVE_DEVICE: '/images/ic_remove_device.png', }; /** * Get the icon for the notification * @param {GaeMsg} data message object * @returns {?string} path to icon, null for * actions without notifications (ping) * @memberOf app.Notify */ function _getIcon(data) { let path = ''; if (data.act === app.Msg.ACTION.MESSAGE) { path = ICON.LOCAL_COPY; } else if (data.act === app.Msg.ACTION.DEVICE_ADDED) { path = ICON.ADD_DEVICE; } else if (data.act === app.Msg.ACTION.DEVICE_REMOVED) { path = ICON.REMOVE_DEVICE; } return path; } /** * Event: Fired when the user clicked in a non-button area * of the notification. * @see https://developer.chrome.com/apps/notifications#event-onClicked * @param {string} id - notification type * @private * @memberOf app.Notify */ function _onNotificationClicked(id) { app.Notify.showMainTab(); chrome.notifications.clear(id, () =&gt; {}); } // Listen for click on our notifications chrome.notifications.onClicked.addListener(_onNotificationClicked); return { /** * Send notification type * @memberOf app.Notify */ NOTIFY_SEND: NOTIFY_SEND, /** * Create and display a notification * @param {string} type - notification type (send or receive) * @param {GaeMsg} data - message data * @memberOf app.Notify */ create: function(type, data) { const options = { type: 'basic', title: 'Pushy', isClickable: true, eventTime: Date.now(), }; const icon = _getIcon(data); if (!icon) { // skip ping messages return; } chrome.notifications.getPermissionLevel(function(level) { if (level === 'granted') { switch (type) { case NOTIFY_SEND: options.iconUrl = chrome.runtime.getURL(icon); options.title = 'Sent push message'; options.message = data.m; chrome.notifications .create(type, options, () =&gt; {}); break; default: break; } } }); }, /** * Determine if send notifications are enabled * @returns {boolean} true if enabled * @memberOf app.Notify */ onSend: function() { const notify = app.Utils.get('notify'); const notifyOnSend = app.Utils.get('notifyOnSend'); return notify &amp;&amp; notifyOnSend; }, /** * Send message to the main tab to focus it. If not found, create it * @memberOf app.Notify */ showMainTab: function() { chrome.runtime.sendMessage({ message: 'highlightTab', }, (response) =&gt; { if (!response) { // no one listening, create it chrome.tabs.create({url: '../html/main.html'}); } }); }, }; })(); × Search results Close "},"permissions.js.html":{"id":"permissions.js.html","title":"Source: permissions.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: permissions.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Handle optional permissions * @namespace */ app.Permissions = (function() { 'use strict'; new ExceptionHandler(); const chromep = new ChromePromise(); /** @memberOf app.Permissions */ const PERMISSIONS = ['tabs']; /** @memberOf app.Permissions */ const ORIGINS = ['http://*/*', 'https://*/*']; /** @memberOf app.Permissions */ const NOT_SET = 'notSet'; /** @memberOf app.Permissions */ const ALLOWED = 'allowed'; /** @memberOf app.Permissions */ const DENIED = 'denied'; return { /** @memberOf app.Permissions */ NOT_SET: NOT_SET, /** @memberOf app.Permissions */ ALLOWED: ALLOWED, /** @memberOf app.Permissions */ DENIED: DENIED, /** * Has use made choice on permissions * @returns {boolean} true if allowed or denied * @memberOf app.Permissions */ notSet: function() { return app.Utils.get('permissions') === NOT_SET; }, /** * Has the user allowed the optional permissions * @returns {boolean} true if allowed * @memberOf app.Permissions */ isAllowed: function() { return app.Utils.get('permissions') === ALLOWED; }, /** * Prompt for the optional permissions * @returns {Promise&lt;boolean&gt;} true if permission granted * @memberOf app.Permissions */ request: function() { // if promise chain const ifGranted = function(isTrue) { if (isTrue) { app.Utils.set('permissions', app.Permissions.ALLOWED); return Promise.resolve(isTrue); } else { // remove if it has been previously granted return app.Permissions.remove().then(() =&gt; { return Promise.resolve(isTrue); }); } }; return chromep.permissions.request({ permissions: PERMISSIONS, origins: ORIGINS, }).then((granted) =&gt; { return ifGranted(granted); }); }, /** * Determine if we have the optional permissions * @returns {Promise&lt;boolean&gt;} true if we have permissions * @memberOf app.Permissions */ contains: function() { return chromep.permissions.contains({ permissions: PERMISSIONS, origins: ORIGINS, }); }, /** * Remove the optional permissions * @returns {Promise&lt;boolean&gt;} true if removed * @memberOf app.Permissions */ remove: function() { // if promise chain const ifContains = function(isTrue) { if (isTrue) { // remove permission return chromep.permissions.remove({ permissions: PERMISSIONS, }).then((removed) =&gt; { if (removed) { app.Utils.set('permissions', app.Permissions.DENIED); } return Promise.resolve(removed); }); } else { return Promise.resolve(isTrue); } }; return app.Permissions.contains().then((contains) =&gt; { return ifContains(contains); }); }, /** * Inject our script into all tabs that match * @memberOf app.Permissions */ injectContentScripts: function() { // noinspection JSCheckFunctionSignatures if (app.Permissions.isAllowed()) { chrome.windows.getAll({populate: true}, function(windows) { for (let i = 0; i &lt; windows.length; i++) { // all windows const win = windows[i]; for (let j = 0; j &lt; win.tabs.length; j++) { // all tabs in window const tab = win.tabs[j]; // our matches if (tab.url.match(/(http|https):\\/\\//gi)) { app.Permissions.injectContentScript(tab.id); } } } }); } }, /** * Inject our script into the given tab * @param {int} tabId - tab to inject * @memberOf app.Permissions */ injectContentScript: function(tabId) { if (app.Permissions.isAllowed()) { chrome.tabs.executeScript(tabId, { file: 'scripts/on_copy_cut_content_script.js', allFrames: true, matchAboutBlank: true, }, function() { if (chrome.runtime.lastError) { // noinspection UnnecessaryReturnStatementJS return; } }); } }, }; })(); × Search results Close "},"registration_client.js.html":{"id":"registration_client.js.html","title":"Source: registration_client.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: registration_client.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Handle RegistrationEndpoint tasks on the gae server * @namespace */ app.Reg = (function() { 'use strict'; new ExceptionHandler(); /** * Base path of RegistrationEndpoint * @type string * @const * @private * @memberOf app.Reg */ const URL_BASE = `${app.Gae.GAE_ROOT}/registration/v1/`; const ERROR_REGISTER = 'Failed to register with the server.\\n'; const ERROR_UNREGISTER = 'Failed to unregister with the server.\\n'; /** * Send request to server Endpoint * @param {string} url - Endpoint path * @param {string} errorPrefix - text prefix to add to Error on reject * @returns {Promise&lt;void&gt;} void * @private * @memberOf app.Reg */ function _doCommand(url, errorPrefix) { return app.User.getAuthToken(true).then((token) =&gt; { return app.Gae.doPost(url, token, true); }).then(() =&gt; { return Promise.resolve(); }).catch((err) =&gt; { throw new Error(errorPrefix + err); }); } /** * Event: Fired when item in localStorage changes * @see https://developer.mozilla.org/en-US/docs/Web/Events/storage * @param {Event} event - storage event * @param {string} event.key - storage item that changed * @private * @memberOf app.Reg */ function _onStorageChanged(event) { if (event.key === 'allowReceive') { const allowReceive = app.Utils.allowReceive(); if (allowReceive) { // user wants to receive messages now app.Reg.register().catch((err) =&gt; { app.GA.error(err.message, 'Reg._onStorageChanged'); app.Utils.set('allowReceive', !allowReceive); chrome.runtime.sendMessage({ message: 'registerFailed', error: err.toString(), }, () =&gt; {}); }); } else { // user no longer wants to receive messages app.Reg.unregister().catch((err) =&gt; { app.GA.error(err.message, 'Reg._onStorageChanged'); app.Utils.set('allowReceive', !allowReceive); chrome.runtime.sendMessage({ message: 'unregisterFailed', error: err.toString(), }, () =&gt; {}); }); } } } /** * Listen for changes to localStorage */ addEventListener('storage', _onStorageChanged, false); return { /** * Register {@link Device} with server * @returns {Promise&lt;void&gt;} void * @memberOf app.Reg */ register: function() { if (app.Utils.isRegistered() || !app.Utils.allowReceive()) { return Promise.resolve(); } return app.Fb.getRegToken().then((regId) =&gt; { const url = `${URL_BASE}register/${regId}`; return _doCommand(url, ERROR_REGISTER); }).then(() =&gt; { app.GA.event(app.GA.EVENT.REGISTERED); app.Utils.set('registered', true); return Promise.resolve(); }); }, /** * Unregister {@link Device} with server * @returns {Promise&lt;void&gt;} void * @memberOf app.Reg */ unregister: function() { if (app.Utils.notRegistered()) { return Promise.resolve(); } return app.Fb.getRegToken().then((regId) =&gt; { const url = `${URL_BASE}unregister/${regId}`; return _doCommand(url, ERROR_UNREGISTER); }).then(() =&gt; { app.GA.event(app.GA.EVENT.UNREGISTERED); app.Utils.set('registered', false); return Promise.resolve(); }); }, }; })(); × Search results Close "},"service_worker.js.html":{"id":"service_worker.js.html","title":"Source: service_worker.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: service_worker.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Manage lifecycle of our {@link ServiceWorker} * @namespace */ app.SW = (function() { 'use strict'; new ExceptionHandler(); const ERROR_REG = 'Failed to register Service Worker: '; const ERROR_UNREG = 'Failed to unregister Service Worker: '; const ERROR_NOT_REG = 'Not registered '; const ERROR_UNREG_BOOL = 'returned false'; /** * Path to our {@link ServiceWorker} * @const * @default * @private * @memberOf app.SW */ const SERVICE_WORKER = '../scripts/sw.js'; /** * Our ServiceWorkerRegistration object * @private * @memberOf app.SW */ let _swRegistration = null; /** * Register the Service Worker * Note: This can be called if already registered * @returns {Promise&lt;Object&gt;} service worker * @private * @memberOf app.SW */ function _register() { return navigator.serviceWorker.register(SERVICE_WORKER) .then((swReg) =&gt; { _swRegistration = swReg; return Promise.resolve(_swRegistration); }).catch((err) =&gt; { return Promise.reject(new Error(ERROR_REG + err.message)); }); } /** * Unsubscribe from push notifications * @returns {Promise&lt;void&gt;} void * @private * @memberOf app.SW */ function _unsubscribePush() { return _swRegistration.pushManager.getSubscription() .then((subscription) =&gt; { if (subscription) { return subscription.unsubscribe(); } else { return Promise.reject(new Error('Not subscribed')); } }); } return { /** * Initialize the {@link ServiceWorker} and firebase * @returns {Promise&lt;void&gt;} void * @memberOf app.SW */ initialize: function() { if (_swRegistration) { return Promise.resolve(); } return _register().then((swReg) =&gt; { return app.Fb.initialize(swReg); }).then(() =&gt; { return Promise.resolve(); }).catch((err) =&gt; { return Promise.reject(new Error(ERROR_REG + err.message)); }); }, /** * Unregister the Service Worker * @returns {Promise&lt;void&gt;} void * @memberOf app.SW */ unregister: function() { if (!_swRegistration) { return Promise.reject(new Error(ERROR_UNREG + ERROR_NOT_REG)); } return _unsubscribePush().then(() =&gt; { return _swRegistration.unregister(); }).then((boolean) =&gt; { if (!boolean) { throw new Error(ERROR_UNREG_BOOL); } else { _swRegistration = null; return Promise.resolve(); } }).catch((err) =&gt; { return Promise.reject(new Error(ERROR_UNREG + err.message)); }); }, /** * Update the Service Worker * @returns {Promise&lt;void&gt;} void always resolves * @memberOf app.SW */ update: function() { if (_swRegistration) { _swRegistration.update(); } return Promise.resolve(); }, }; })(); × Search results Close "},"user.js.html":{"id":"user.js.html","title":"Source: user.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: user.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Manage the current user * @namespace */ app.User = (function() { 'use strict'; new ExceptionHandler(); const ERROR_ALREADY_SIGNED_IN = 'Already signed in'; /** * Event: Fired when signin state changes for an account on the user's * profile. * @see https://developer.chrome.com/apps/identity#event-onSignInChanged * @param {Object} account - chrome AccountInfo * @param {boolean} signedIn - true if signedIn * @private * @memberOf app.User */ function _onSignInChanged(account, signedIn) { const uid = app.Utils.get('uid'); if (app.Utils.isSignedIn() &amp;&amp; !signedIn &amp;&amp; (account.id === uid)) { // our user signed out of Chrome while we were signed in app.Utils.set('needsCleanup', true); _setSignIn(false); app.Utils.set('registered', false); app.Fb.signOut(); } app.User.setInfo().catch((err) =&gt; { app.GA.error(err.message, 'User._onSignInChanged'); }); } // noinspection JSUnusedLocalSymbols /** * Event: Fired when a message is sent from either an extension process&lt;br&gt; * (by runtime.sendMessage) or a content script (by tabs.sendMessage). * @see https://developer.chrome.com/extensions/runtime#event-onMessage * @param {Object} request - details for the message * @param {Object} sender - MessageSender object * @param {function} response - function to call once after processing * @returns {boolean} true if asynchronous * @private * @memberOf app.User */ function _onChromeMessage(request, sender, response) { let ret = false; if (request.message === 'signIn') { // try to signIn a user ret = true; // async app.User.addAccess().then(() =&gt; { response({message: 'ok'}); return Promise.resolve(); }).catch((err) =&gt; { app.GA.error(err.message, 'User._onChromeMessage'); app.User.removeAccess().then(() =&gt; { return Promise.resolve(); }).catch((err) =&gt; { app.GA.error(err.message, 'User._onChromeMessage'); _setSignIn(false); app.Utils.set('registered', false); }); response({message: 'error', error: err.toString()}); }); } else if (request.message === 'signOut') { // try to signOut a user ret = true; // async app.User.removeAccess().then(() =&gt; { response({message: 'ok'}); return Promise.resolve(); }).catch((err) =&gt; { app.GA.error(err.message, 'User._onChromeMessage'); response({message: 'error', error: err.toString()}); }); } return ret; } /** * Set signIn state * @param {boolean} val - true if signed in * @private */ function _setSignIn(val) { app.Utils.set('signedIn', val); app.Utils.setBadgeText(); if (!val) { app.Utils.set('photoURL', ''); } } /** * Listen for changes to Browser sign-in */ chrome.identity.onSignInChanged.addListener(_onSignInChanged); /** * Listen for Chrome messages */ chrome.runtime.onMessage.addListener(_onChromeMessage); return { /** * SignIn with OAuth 2.0 and firebase * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ signIn: function() { if (app.Utils.isSignedIn()) { return Promise.reject(new Error(ERROR_ALREADY_SIGNED_IN)); } return app.User.getAuthToken(true).then((token) =&gt; { return app.Fb.signIn(token); }).then((user) =&gt; { _setSignIn(true); if (!app.Utils.isWhiteSpace(user.photoURL)) { app.Utils.set('photoURL', user.photoURL); } return Promise.resolve(); }); }, /** * Sign-out of firebase * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ signOut: function() { if (!app.Utils.isSignedIn()) { return Promise.resolve(); } return app.Fb.signOut().then(() =&gt; { _setSignIn(false); return Promise.resolve(); }); }, /** * Sign in and register {@link Device} * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ addAccess: function() { /** * Cleanup if user signed-out of Browser * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ function ifCleanup() { if (app.Utils.get('needsCleanup')) { app.Utils.set('needsCleanup', false); return app.User.cleanup(); } else { return Promise.resolve(); } } return ifCleanup().then(() =&gt; { return app.User.signIn(); }).then(() =&gt; { return app.Reg.register(); }).then(() =&gt; { return app.Msg.sendDeviceAdded(); }); }, /** * Unregister {@link Device} and sign out * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ removeAccess: function() { return app.Msg.sendDeviceRemoved().then(() =&gt; { return app.Reg.unregister(); }).then(() =&gt; { return app.User.signOut(); }).then(() =&gt; { app.Devices.clear(); return Promise.resolve(); }); }, /** * Get an OAuth2.0 token * @see https://developer.chrome.com/apps/identity#method-getAuthToken * @param {boolean} retry - if true, retry with new token on error * @returns {Promise&lt;token&gt;} An access token * @memberOf app.User */ getAuthToken: function(retry) { // If signed in, first try to get token non-interactively. // If it fails, probably means token has expired or is invalid. const interactive = !app.Utils.isSignedIn(); const chromep = new ChromePromise(); return chromep.identity.getAuthToken({ 'interactive': interactive, }).then((token) =&gt; { if (chrome.runtime.lastError) { const error = chrome.runtime.lastError.message; if (retry &amp;&amp; error &amp;&amp; token) { // cached token may be expired or invalid. // remove it and try again return app.User.removeCachedAuthToken(token) .then(() =&gt; { return app.User.getAuthToken(false); }); } else { throw new Error(error); } } else { return Promise.resolve(token); } }); }, /** * Cleanup after user signs out of Browser * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ cleanup: function() { return app.User.getAuthToken(false).then((token) =&gt; { return app.User.removeCachedAuthToken(token); }); }, /** * Remove Auth token from cache * @param {string} token - Auth token * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ removeCachedAuthToken: function(token) { const chromep = new ChromePromise(); return chromep.identity.removeCachedAuthToken({'token': token}); }, /** * Persist info on current Browser user (may be no-one) * @returns {Promise&lt;void&gt;} void * @memberOf app.User */ setInfo: function() { const chromep = new ChromePromise(); return chromep.identity.getProfileUserInfo().then((user) =&gt; { app.Utils.set('email', user.email); app.Utils.set('uid', user.id); return Promise.resolve(); }); }, }; })(); × Search results Close "},"utils.js.html":{"id":"utils.js.html","title":"Source: utils.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: utils.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; /** * Misc. utility methods * @namespace */ app.Utils = (function() { 'use strict'; new ExceptionHandler(); const MIN_IN_DAY = 60 * 24; const MILLIS_IN_DAY = MIN_IN_DAY * 60 * 1000; return { /** * Number of minutes in a day * @const * @type {int} * @memberOf app.Utils */ MIN_IN_DAY: MIN_IN_DAY, /** * Number of milliseconds a in day * @const * @type {int} * @memberOf app.Utils */ MILLIS_IN_DAY: MILLIS_IN_DAY, /** Get the extension's name * @returns {string} name of extension * @memberOf app.Utils */ getExtensionName: function() { return `chrome-extension://${chrome.runtime.id}`; }, /** * Get the Extension version * @returns {string} Extension version * @memberOf app.Utils */ getVersion: function() { const manifest = chrome.runtime.getManifest(); return manifest.version; }, /** * Get the major Chrome version * @see https://goo.gl/2ITMNO * @returns {int} Chrome major version * @memberOf app.Utils */ getChromeVersion: function() { const raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./); return raw ? parseInt(raw[2], 10) : false; }, /** * Get the full Chrome version * @see https://goo.gl/2ITMNO * @returns {string} Chrome version * @memberOf app.Utils */ getFullChromeVersion: function() { const raw = navigator.userAgent; return raw ? raw : 'Unknown'; }, /** * Get the OS as a human readable string * @returns {Promise.&lt;string&gt;} OS name * @memberOf app.Utils */ getPlatformOS: function() { const chromep = new ChromePromise(); return chromep.runtime.getPlatformInfo().then((info) =&gt; { let output = 'Unknown'; const os = info.os; switch (os) { case 'win': output = 'MS Windows'; break; case 'mac': output = 'Mac'; break; case 'android': output = 'Android'; break; case 'cros': output = 'Chrome OS'; break; case 'linux': output = 'Linux'; break; case 'openbsd': output = 'OpenBSD'; break; default: break; } return Promise.resolve(output); }); }, /** * Get a JSON parsed value from localStorage * @param {string} key - key to get value for * @returns {JSON|null} JSON object, null if key does not exist * @memberOf app.Utils */ get: function(key) { let item = localStorage.getItem(key); if (item !== null) { item = JSON.parse(item); } return item; }, /** * JSON stringify and save a value to localStorage * @param {string} key - key to set value for * @param {?Object} value - new value, if null remove item * @memberOf app.Utils */ set: function(key, value) { if (value !== null) { localStorage.setItem(key, JSON.stringify(value)); } else { localStorage.removeItem(key); } }, /** * Get integer value from localStorage * @param {!string} key - key to get value for * @returns {?int} value as integer * @memberOf app.Utils */ getInt: function(key) { let item = localStorage.getItem(key); if (item !== null) { item = parseInt(item, 10); } return item; }, /** * Are we saving clipboard contents * @returns {boolean} true if enabled * @memberOf app.Utils */ isMonitorClipboard: function() { return app.Utils.get('monitorClipboard'); }, /** * Has user enabled pushing to {@link app.Devices} * @returns {boolean} true if enabled * @memberOf app.Utils */ allowPush: function() { return app.Utils.get('allowPush'); }, /** * Has user enabled autoSend option * @returns {boolean} true if enabled * @memberOf app.Utils */ isAutoSend: function() { return app.Utils.get('autoSend'); }, /** * Has user enabled receiving from {@link app.Devices} * @returns {boolean} true if enabled * @memberOf app.Utils */ allowReceive: function() { return app.Utils.get('allowReceive'); }, /** * Are we signed in * @returns {boolean} true if signed in * @memberOf app.Utils */ isSignedIn: function() { return this.get('signedIn'); }, /** * Are we registered with fcm * @returns {boolean} true if registered * @memberOf app.Utils */ isRegistered: function() { return this.get('registered'); }, /** * Are we not registered with fcm * @returns {boolean} true if not registered * @memberOf app.Utils */ notRegistered: function() { return !this.isRegistered(); }, /** * Set the badge displayed on the extension icon * @memberOf app.Utils */ setBadgeText: function() { let text = ''; if (app.Utils.isSignedIn() &amp;&amp; app.Utils.allowPush()) { text = 'SEND'; } chrome.browserAction.setBadgeText({text: text}); }, /** * Determine if a String is null or whitespace only * @param {string} str - string to check * @returns {boolean} true if str is whitespace (or null) * @memberOf app.Utils */ isWhiteSpace: function(str) { return (!str || str.length === 0 || /^\\s*$/.test(str)); }, /** * Get a date string in time ago format * @param {int} time - time since epoch in millis * @returns {string} Relative time format * @memberOf app.Utils */ getRelativeTime: function(time) { return `${moment(time).fromNow()}, ` + `${moment(time).format('h:mm a')}`; }, /** * Get a random string of the given length * @param {int|null} len - length of generated string, 8 if null * @returns {string} a random string * @memberOf app.Utils * */ randomString: function(len) { const POSS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz0123456789'; !len ? len = 8 : true; if (!len) { len = 8; } let text = ''; for (let i = 0; i &lt; len; i++) { text += POSS.charAt(Math.floor(Math.random() * POSS.length)); } return text; }, }; })(window); × Search results Close "},"background.js.html":{"id":"background.js.html","title":"Source: background.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: background.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ (function() { 'use strict'; new ExceptionHandler(); /** * The background script for the extension.&lt;br&gt; * Note: We can't be an Event Page because we use * the chrome.webRequest API * @namespace BG */ /** * Version of localStorage - update when items are added, removed, changed * @type {int} * @default * @const * @private * @memberOf BG */ const DATA_VERSION = 2; /** * Default values in localStorage * @type {{version: int, monitorClipboard: boolean, allowPush: boolean, * autoSend: boolean, permissions: string, allowReceive: boolean, * deviceSN: string, deviceNickname: string, storageDuration: number, * notify: boolean, notifyOnSend: boolean, notifyOnReceive: boolean, * highPriority: boolean, devices: {}, signedIn: boolean, * needsCleanup: boolean, email: string, uid: string, photoURL: string, * registered: boolean}} * @const * @private * @memberOf BG */ const DEF_VALUES = { 'version': DATA_VERSION, 'monitorClipboard': true, 'allowPush': true, 'autoSend': true, 'permissions': 'notSet', // enum: notSet allowed denied 'allowReceive': true, 'deviceSN': app.Utils.randomString(8), 'deviceNickname': '', 'storageDuration': 2, 'notify': true, 'notifyOnSend': false, 'notifyOnReceive': true, 'highPriority': true, 'devices': {}, 'signedIn': false, 'needsCleanup': false, 'email': '', 'uid': '', 'photoURL': '', 'registered': false, }; /** * Initial {@link ClipItem} * @type {string} * @default * @const * @private * @memberOf BG */ const INTRO_TEXT = `A clipboard manager with push notifications. Please signin from the &quot;Manage Account&quot; page to share with your \\ other devices. You can click on the toolbar icon at any time to send the current \\ contents of the clipboard to all your other devices. Information you copy in most Chrome pages will \\ automatically be sent if you have enabled that in &quot;Settings&quot;. You can display this page by right clicking on the toolbar icon and \\ selecting &quot;Options&quot;. It is a good idea to go to the &quot;Settings&quot; page and enter a nickname \\ for this device.`; /** * Event: Fired when the extension is first installed,&lt;br /&gt; * when the extension is updated to a new version,&lt;br /&gt; * and when Chrome is updated to a new version. * @see https://developer.chrome.com/extensions/runtime#event-onInstalled * @param {Object} details - type of event * @private * @memberOf BG */ function _onInstalled(details) { if (details.reason === 'install') { // extension installed app.GA.event(app.GA.EVENT.INSTALLED); // save OS app.Utils.getPlatformOS().then((os) =&gt; { app.Utils.set('os', os); return null; }).catch((err) =&gt; { app.GA.error(err.message, 'BG._onInstalled'); }); _initializeData(); app.Notify.showMainTab(); } else if (details.reason === 'update') { _updateData(); _initializeFirebase().then(() =&gt; { return app.SW.update(); }).catch((err) =&gt; { app.GA.error(err.message, 'BG._onInstalled'); }); } app.Utils.setBadgeText(); app.Alarm.updateAlarms(); app.Permissions.injectContentScripts(); } /** * Event: Fired when a profile that has this extension installed first * starts up * @see https://developer.chrome.com/extensions/runtime#event-onStartup * @private * @memberOf BG */ function _onStartup() { app.GA.page('/background.html'); app.Alarm.updateAlarms(); app.Alarm.deleteOldClipItems(); _initializeFirebase().catch((err) =&gt; { app.GA.error(err.message, 'BG._onStartup'); }); app.Utils.setBadgeText(); } /** * Event: Fired when a browser action icon is clicked. * @see https://goo.gl/abVwKu * @private * @memberOf BG */ function _onIconClicked() { // get the clipboard contents const text = app.CB.getTextFromClipboard(); if (app.Utils.isWhiteSpace(text)) { return; } // Persist app.ClipItem.add(text, Date.now(), false, false, app.Device.myName()).then((clipItem) =&gt; { // eslint-disable-next-line promise/no-nesting return app.Msg.sendClipItem(clipItem).catch((err) =&gt; { app.Gae.sendMessageFailed(err); }); }).catch((err) =&gt; { app.GA.error(err.message, 'BG._onIconClicked'); }); } /** * Event: Fired when a tab is updated. * @see https://developer.chrome.com/extensions/tabs#event-onUpdated * @param {int} tabId - id of tab * @private * @memberOf BG */ function _onTabUpdated(tabId) { app.Permissions.injectContentScript(tabId); } /** * Event: Fired when item in localStorage changes * @see https://developer.mozilla.org/en-US/docs/Web/Events/storage * @param {Event} event - storage event * @param {string} event.key - storage item that changed * @private * @memberOf BG */ function _onStorageChanged(event) { if ((event.key === 'allowPush') || (event.key === 'signedIn')) { app.Utils.setBadgeText(); } } /** * Save the {@link Background.DEF_VALUES} array to localStorage * @private * @memberOf BG */ function _saveDefaults() { Object.keys(DEF_VALUES).forEach(function(key) { if (app.Utils.get(key) === null) { app.Utils.set(key, DEF_VALUES[key]); } }); } /** * Initialize the data saved in localStorage * @private * @memberOf BG */ function _initializeData() { _saveDefaults(); const introClip = new app.ClipItem(INTRO_TEXT, Date.now(), true, false, app.Device.myName()); introClip.save().catch((err) =&gt; { app.GA.error(err.message, 'BG._initializeData'); }); app.User.setInfo().catch((err) =&gt; { app.GA.error(err.message, 'BG._initializeData'); }); } /** * Update the data saved in localStorage * @private * @memberOf BG */ function _updateData() { // New items and removal of unused items can take place here // when the version changes const oldVersion = app.Utils.getInt('version'); if (DATA_VERSION &gt; oldVersion) { // update version number app.Utils.set('version', DATA_VERSION); } if (oldVersion &lt; 2) { // remove unused variables localStorage.removeItem('lastEmail'); localStorage.removeItem('lastUid'); } _saveDefaults(); } /** * Initialize firebase and Service Worker if signed in * @returns {Promise&lt;void&gt;} void * @private * @memberOf BG */ function _initializeFirebase() { if (app.Utils.isSignedIn()) { return app.SW.initialize().catch((err) =&gt; { app.GA.error(err.message, 'BG._initializeFirebase'); }); } else { return Promise.resolve(); } } // Listen for extension install or update chrome.runtime.onInstalled.addListener(_onInstalled); // Listen for Chrome starting chrome.runtime.onStartup.addListener(_onStartup); // Listen for click on the icon chrome.browserAction.onClicked.addListener(_onIconClicked); // Listen for tab updates chrome.tabs.onUpdated.addListener(_onTabUpdated); // Listen for changes to localStorage addEventListener('storage', _onStorageChanged, false); })(); × Search results Close "},"clip_item.js.html":{"id":"clip_item.js.html","title":"Source: clip_item.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: clip_item.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ (function(window) { 'use strict'; new ExceptionHandler(); /** * Create a new {@link ClipItem} * @constructor * @alias ClipItem * @param {string} text - The text of the clip * @param {int} date - Time in milliSecs from epoch * @param {boolean} fav - true if this has been marked as a favorite * @param {boolean} remote - true if this came from a device other than ours * @param {string} device - A String representing the source device */ const ClipItem = function(text, date, fav, remote, device) { this.text = text; this.date = date; this.fav = fav; this.remote = remote; this.device = device; }; /** * The Dexie database * @see http://dexie.org/ * @type {Object} * @private * @memberOf ClipItem */ let _db; /** * The Dexie database version * @const * @type {int} * @private * @memberOf ClipItem */ const VERSION = 1; /** * Error indicating that {@link ClipItem} text is null or all whitespace * @const * @default * @type {string} */ ClipItem.ERROR_EMPTY_TEXT = 'Empty text'; /** * Set date * @param {int} date - millis from epoch */ ClipItem.prototype.setDate = function(date) { this.date = date; }; /** * Get fav * @returns {boolean} fav */ ClipItem.prototype.getFav = function() { return this.fav; }; /** * Set favorite * @param {boolean} fav - is item a favorite */ ClipItem.prototype.setFav = function(fav) { this.fav = fav; }; /** * Set remote * @param {boolean} remote - true if not from our {@link Device} */ ClipItem.prototype.setRemote = function(remote) { this.remote = remote; }; /** * Save ourselves to storage * @returns {Promise&lt;string&gt;} primary key it was stored under */ ClipItem.prototype.save = function() { if (app.Utils.isWhiteSpace(this.text)) { return Promise.reject(new Error(ClipItem.ERROR_EMPTY_TEXT)); } return _db.clipItems.put(this); }; /** * Determine if {@link ClipItem} text exists in storage * @returns {Promise&lt;boolean&gt;} true if text exists */ ClipItem.prototype.exists = function() { return _db.clipItems.get(this.text).then((item) =&gt; { return Promise.resolve((item !== undefined)); }); }; /** * Add new {@link ClipItem} to storage * @param {string} text - The text of the clip * @param {int} date - Time in milliSecs from epoch * @param {boolean} fav - true if this has been marked as a favorite * @param {boolean} remote - true if this came from a device other than ours * @param {string} device - A String representing the source device * @returns {Promise&lt;ClipItem&gt;} A new {@link ClipItem} */ ClipItem.add = function(text, date, fav, remote, device) { let updated; const clipItem = new ClipItem(text, date, fav, remote, device); return clipItem.exists().then((isTrue) =&gt; { updated = isTrue; return clipItem.save(); }).then(() =&gt; { // let listeners know a ClipItem was added or updated chrome.runtime.sendMessage({ message: 'clipAdded', clipItem: clipItem, updated: updated, }, (response) =&gt; {}); return Promise.resolve(clipItem); }); }; /** * Remove the given keys from storage * @param {string[]} keys - array of keys to delete * @returns {Promise&lt;void&gt;} void */ ClipItem.remove = function(keys) { return _db.clipItems.bulkDelete(keys); }; /** * Return true is there are no stored {@link ClipItem} objects * @returns {Promise&lt;boolean&gt;} true if no {@link ClipItem} objects */ ClipItem.isEmpty = function() { return _db.clipItems.count().then((count) =&gt; { return Promise.resolve(!count); }); }; /** * Return all the {@link ClipItem} objects from storage * @returns {Promise&lt;Array&gt;} Array of {@link ClipItem} objects */ ClipItem.loadAll = function() { return _db.clipItems.toArray(); }; /** * Delete items older than the storageDuration setting * @returns {Promise&lt;boolean&gt;} true if items were deleted */ ClipItem.deleteOld = function() { const durIndex = app.Utils.getInt('storageDuration'); const durations = [ app.Utils.MILLIS_IN_DAY, app.Utils.MILLIS_IN_DAY * 7, app.Utils.MILLIS_IN_DAY * 30, app.Utils.MILLIS_IN_DAY * 365, ]; if (durIndex === 4) { // store forever return Promise.resolve(false); } else { const olderThanTime = Date.now() - durations[durIndex]; return ClipItem._deleteOlderThan(olderThanTime); } }; /** * Delete non-favorite {@link ClipItem} objects older than the given time * @param {int} time - time in millis since epoch * @returns {Promise&lt;boolean&gt;} true if items were deleted * @private */ ClipItem._deleteOlderThan = function(time) { return _db.clipItems .where('date').below(time) .filter(function(clipItem) { return !clipItem.fav; }) .delete() .then((deleteCount) =&gt; { return Promise.resolve(!!deleteCount); }); }; /** * Event: called when document and resources are loaded&lt;br /&gt; * Initialize Dexie * @private * @memberOf ClipItem */ function _onLoad() { _db = new Dexie('ClipItemsDB'); // define database _db.version(VERSION).stores({ clipItems: '&amp;text,date', }); _db.clipItems.mapToClass(ClipItem); } // listen for document and resources loaded window.addEventListener('load', _onLoad); window.app = window.app || {}; window.app.ClipItem = ClipItem; })(window); × Search results Close "},"on_copy_cut_content_script.js.html":{"id":"on_copy_cut_content_script.js.html","title":"Source: on_copy_cut_content_script.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: on_copy_cut_content_script.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ /** * Content script to monitor clipboard copy and cuts * @namespace ContentScript */ (function() { 'use strict'; if (window.onMyCopy) { window.removeEventListener('copy', window.onMyCopy); window.removeEventListener('cut', window.onMyCopy); } /** * On copy or cut event, send a message to our extension * @memberOf ContentScript */ window.onMyCopy = function onMyCopy() { try { chrome.runtime.sendMessage(chrome.runtime.id, { message: 'copiedToClipboard', }, () =&gt; {}); } catch(ex) { // noinspection UnnecessaryReturnStatementJS return; } }; window.addEventListener('copy', window.onMyCopy); window.addEventListener('cut', window.onMyCopy); })(); × Search results Close "},"device.js.html":{"id":"device.js.html","title":"Source: device.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: device.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ (function(window) { 'use strict'; new ExceptionHandler(); /** * Creates a new Device instance. * @constructor * @alias Device * @param {string} model - The model name of a device * @param {string} sn - The serial number (or other descriptor) of a device * @param {string} os - The operating system of a device * @param {string} nickname - The nickname of a device * @param {int} lastSeen - A date in millis from the epoch */ const Device = function(model, sn, os, nickname, lastSeen) { this.model = model; this.sn = sn; this.os = os; this.nickname = nickname; if (lastSeen) { this.lastSeen = lastSeen; } else { this.lastSeen = Date.now(); } }; /** * Model key * @const * @default */ Device.MODEL = 'dM'; /** * Serial Number key * @const * @default */ Device.SN = 'dSN'; /** * Operating system key * @const * @default */ Device.OS = 'dOS'; /** * Nickname key * @const * @default */ Device.NICKNAME = 'dN'; /** * Get a String that uniquely (hopefully) determines this {@link Device} * @returns {string} unique name */ Device.prototype.getUniqueName = function() { return `${this.model} - ${this.sn} - ${this.os}`; }; /** * Get name suitable for display * @returns {string} descriptive name of {@link Device} */ Device.prototype.getName = function() { let name = this.nickname; if (app.Utils.isWhiteSpace(name)) { name = this.getUniqueName(); } return name; }; /** * Determine if this is our {@link Device} * @returns {boolean} true if this is our {@link Device} */ Device.prototype.isMe = function() { return (this.getUniqueName() === Device.myUniqueName()); }; /** * Get unique name of our {@link Device} * @returns {string} unique name */ Device.myUniqueName = function() { return `${Device.myModel()} - ${Device.mySN()} - ${Device.myOS()}`; }; /** * Get display name of our {@link Device} * @returns {string} display name */ Device.myName = function() { let name = Device.myNickname(); if (app.Utils.isWhiteSpace(name)) { name = Device.myUniqueName(); } return name; }; /** * Get model name of our {@link Device} * @returns {string} model name */ Device.myModel = function() { return 'Chrome'; }; /** * Get serial number of our {@link Device} * @returns {string} serial number */ Device.mySN = function() { return app.Utils.get('deviceSN'); }; /** * Get operating system of our {@link Device} * @returns {string} operating system */ Device.myOS = function() { return app.Utils.get('os'); }; /** * Get os version of our {@link Device} * @returns {string} operating system version */ Device.myVersion = function() { return app.Utils.getChromeVersion(); }; /** * Get nickname of our {@link Device} * @returns {string} nickname */ Device.myNickname = function() { return app.Utils.get('deviceNickname'); }; window.app = window.app || {}; window.app.Device = Device; })(window); × Search results Close "},"exception_handler.js.html":{"id":"exception_handler.js.html","title":"Source: exception_handler.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: exception_handler.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ // noinspection ThisExpressionReferencesGlobalObjectJS (function(window, factory) { window.ExceptionHandler = factory(window); }(this, function(window) { 'use strict'; return ExceptionHandler; /** * Log Exceptions with analytics. Include: new ExceptionHandler()&lt;br /&gt; * at top of every js file * @constructor * @alias ExceptionHandler */ function ExceptionHandler() { if (typeof window.onerror === 'object') { // global error handler window.onerror = function(message, url, line, col, errObject) { if (app &amp;&amp; app.GA) { let msg = message; let stack = null; if (errObject &amp;&amp; errObject.message &amp;&amp; errObject.stack) { msg = errObject.message; stack = errObject.stack; } app.GA.exception(msg, stack); } }; } } })); × Search results Close "},"main.js.html":{"id":"main.js.html","title":"Source: main.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: main.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ window.app = window.app || {}; (function() { 'use strict'; /** * Script for the main.html page * @namespace Main */ new ExceptionHandler(); /** * Path to the extension in the Web Store * @type {string} * @memberOf Main */ const EXT_URI = `https://chrome.google.com/webstore/detail/${chrome.runtime.id}/`; /** * Path to the android app in the Play Store * @type {string} * @default * @memberOf Main */ const ANDROID_URI = 'https://play.google.com/store/apps/details' + '?id=com.weebly.opus1269.clipman'; /** * Path to my screen saver extension * @type {string} * @default * @memberOf Main */ const SCREEN_SAVER_URI = 'https://chrome.google.com/webstore/detail/photo-screen-saver/' + 'kohpcmlfdjfdggcjmjhhbcbankgmppgc'; /** * Auto-binding template * @type {Object} * @memberOf Main */ const t = document.querySelector('#t'); /** * Manage an html page that is inserted on demand&lt;br&gt; * May also be a url link to external site * @typedef page * @type {Object} * @property {string} label - label for Nav menu * @property {string} route - element name route to page * @property {string} icon - icon for Nav Menu * @property {object|null} obj - something to be done when selected * @property {boolean} ready - true if html is inserted * @property {boolean} disabled - disabled state of Nav menu * @property {boolean} divider - true for divider before item * @memberOf Main */ /** * Array of {@link Main.page} objects * @type {Main.page[]} * @memberOf Main * @alias Main.pages */ t.pages = [ {label: 'Main', route: 'page-main', icon: 'myicons:list', obj: null, ready: true, disabled: false, divider: false}, {label: 'Manage account', route: 'page-signin', icon: 'myicons:account-circle', obj: _showSignInPage, ready: false, disabled: false, divider: false}, {label: 'Manage devices', route: 'page-devices', icon: 'myicons:phonelink', obj: _showDevicesPage, ready: false, disabled: false, divider: false}, {label: 'Settings', route: 'page-settings', icon: 'myicons:settings', obj: _showSettingsPage, ready: false, disabled: false, divider: false}, {label: 'Manage optional permissions', route: 'page-permissions', icon: 'myicons:perm-data-setting', obj: _showPermissionsDialog, ready: true, disabled: false, divider: false}, {label: 'Help &amp; feedback', route: 'page-help', icon: 'myicons:help', obj: _showHelpPage, ready: false, disabled: false, divider: false}, {label: 'Get android app', route: 'page-android', icon: 'myicons:android', obj: ANDROID_URI, ready: true, disabled: false, divider: true}, {label: 'Rate extension', route: 'page-rate', icon: 'myicons:grade', obj: `${EXT_URI}reviews`, ready: true, disabled: false, divider: false}, {label: 'Try Photo Screen Saver', route: 'page-screensaver', icon: 'myicons:extension', obj: SCREEN_SAVER_URI, ready: true, disabled: false, divider: true}, ]; /** * Error dialog title * @type {string} * @memberOf Main */ t.dialogTitle = ''; /** * Error dialog text * @type {string} * @memberOf Main */ t.dialogText = ''; /** * Current route * @type {string} * @memberOf Main */ t.route = 'page-main'; /** * User photo * @type {string} * @memberOf Main */ t.avatar = app.Utils.get('photoURL'); /** * Previous route * @type {string} * @memberOf Main */ let prevRoute = 'page-main'; /** * signin-page element * @type {element} * @memberOf Main */ let signInPage; /** * devices-page element * @type {element} * @memberOf Main */ let devicesPage; /** * Is the mainPage being displayed * @type {boolean} * @memberOf Main */ let isMainPage = true; /** * Listen for template bound event to know when bindings * have resolved and content has been stamped to the page */ t.addEventListener('dom-change', () =&gt; { // track usage app.GA.page('/main.html'); // disable devices-page if not signed in const idx = _getPageIdx('page-devices'); t.pages[idx].disabled = !app.Utils.isSignedIn(); // listen for Chrome messages chrome.runtime.onMessage.addListener(_onChromeMessage); // check for permissions _checkPermissions(); }); /** * Event: navigation menu selected * @param {Event} event - event * @memberOf Main */ t.onNavMenuItemTapped = function(event) { // Close drawer after menu item is selected _closeDrawer(); prevRoute = t.route; const idx = _getPageIdx(event.currentTarget.id); app.GA.event(app.GA.EVENT.MENU, t.pages[idx].route); if (!t.pages[idx].obj) { // some pages are just pages t.route = t.pages[idx].route; _scrollPageToTop(); } else if (typeof t.pages[idx].obj === 'string') { // some pages are url links t.$.mainMenu.select(prevRoute); chrome.tabs.create({url: t.pages[idx].obj}); } else { // some pages have functions to view them t.pages[idx].obj(idx); } isMainPage = (t.route === 'page-main'); }; /** * Event: display error dialog * @param {Event} event - event * @memberOf Main */ t.onShowErrorDialog = function(event) { t.dialogTitle = event.detail.title; t.dialogText = event.detail.text; t.$.errorDialog.open(); }; /** * Event: {@link Main.page} finished animating in * @memberOf Main */ t.onPageAnimation = function() { if (t.route === 'page-main') { t.$.mainPage.onCurrentPage(); } else if (t.route === 'page-signin') { signInPage.onCurrentPage(); } else if (t.route === 'page-devices') { devicesPage.onCurrentPage(); } }; /** * Event: Clicked on accept permissions dialog button * @memberOf Main */ t.onAcceptPermissionsClicked = function() { app.Permissions.request().then((granted) =&gt; { if (granted) { app.Permissions.injectContentScripts(); } return Promise.resolve(); }).catch((err) =&gt; { app.GA.error(err.message, 'Main.onAcceptPermissionsClicked'); }); }; /** * Event: Clicked on deny permissions dialog button * @memberOf Main */ t.onDenyPermissionsClicked = function() { app.Permissions.remove().catch((err) =&gt; { app.GA.error(err.message, 'Main.onDenyPermissionsClicked'); }); }; /** * Computed Binding: Determine if avatar should be visible * @param {string} avatar - photo url * @returns {string} display type * @memberOf Main */ t.computeAvatarDisplay = function(avatar) { let ret = 'inline'; if (app.Utils.isWhiteSpace(avatar)) { ret = 'none'; } return ret; }; // noinspection JSUnusedLocalSymbols /** * Event: Fired when a message is sent from either an extension process&lt;br&gt; * (by runtime.sendMessage) or a content script (by tabs.sendMessage). * @see https://developer.chrome.com/extensions/runtime#event-onMessage * @param {Object} request - details for the message * @param {Object} sender - MessageSender object * @param {function} response - function to call once after processing * @private * @memberOf Main */ function _onChromeMessage(request, sender, response) { if (request.message === 'highlightTab') { // highlight ourselves and tell the sender we are here // noinspection JSCheckFunctionSignatures chrome.tabs.getCurrent((tab) =&gt; { chrome.tabs.update(tab.id, {'highlighted': true}); }); response({message: 'OK'}); } else if (request.message === 'sendMessageFailed') { t.dialogTitle = 'Failed to send push notification'; t.dialogText = request.error; t.$.errorDialog.open(); } } /** * Event: Fired when item in localStorage changes * @see https://developer.mozilla.org/en-US/docs/Web/Events/storage * @param {Event} event - storage event * @param {string} event.key - value that changed * @private * @memberOf Main */ function _onStorageChanged(event) { if(event.key === 'signedIn') { _setDevicesState(); } else if(event.key === 'photoURL') { t.avatar = app.Utils.get('photoURL'); } } /** * Event: Fired when the highlighted or selected tabs in a window changes. * @see https://developer.chrome.com/extensions/tabs#event-onHighlighted * @param {Object} highlightInfo - info * @private * @memberOf Main */ function _onHighlighted(highlightInfo) { const tabIds = highlightInfo.tabIds; chrome.tabs.getCurrent(function(myTab) { for (let i = 0; i &lt; tabIds.length; i++) { const tabId = tabIds[i]; if (tabId === myTab.id) { // our tab if (!isMainPage) { // focus main page prevRoute = t.route; t.route = 'page-main'; isMainPage = true; t.$.mainMenu.select(t.route); } else { t.$.mainPage.updateDates(); } break; } } }); } /** * Display dialog to prompt for accepting optional permissions * if it has not been set yet * @memberOf Main * @private */ function _checkPermissions() { if (app.Utils.get('permissions') === app.Permissions.NOT_SET) { _showPermissionsDialog(); } } /** * Get the index into the {@link Main.pages} array * @param {string} name - {@link Main.page} route * @returns {int} index into array * @private * @memberOf Main */ function _getPageIdx(name) { return t.pages.map(function(e) { return e.route; }).indexOf(name); } /** * Show the signin page * @param {int} index - index into {@link Main.pages} * @private * @memberOf Main */ function _showSignInPage(index) { if (!t.pages[index].ready) { // insert the page the first time t.pages[index].ready = true; signInPage = new app.SignInPageFactory(); Polymer.dom(t.$.signInInsertion).appendChild(signInPage); } t.route = t.pages[index].route; _scrollPageToTop(); } /** * Show the devices page * @param {int} index - - index into {@link Main.pages} * @private * @memberOf Main */ function _showDevicesPage(index) { if (!t.pages[index].ready) { // insert the page the first time t.pages[index].ready = true; devicesPage = new app.DevicesPageFactory(); Polymer.dom(t.$.devicesInsertion).appendChild(devicesPage); } t.route = t.pages[index].route; _scrollPageToTop(); } /** * Show the settings page * @param {int} index - index into {@link Main.pages} * @private * @memberOf Main */ function _showSettingsPage(index) { if (!t.pages[index].ready) { // insert the page the first time t.pages[index].ready = true; const el = new app.SettingsPageFactory(); Polymer.dom(t.$.settingsInsertion).appendChild(el); } t.route = t.pages[index].route; _scrollPageToTop(); } /** * Show the help page * @param {int} index - index into {@link Main.pages} * @private * @memberOf Main */ function _showHelpPage(index) { if (!t.pages[index].ready) { // insert the page the first time t.pages[index].ready = true; const el = new app.HelpPageFactory(); Polymer.dom(t.$.helpInsertion).appendChild(el); } t.route = t.pages[index].route; _scrollPageToTop(); } /** * Show the permissions dialog * @private * @memberOf Main */ function _showPermissionsDialog() { t.$.permissionsDialog.open(); } /** * Scroll Main Panel to top * @private * @memberOf Main */ function _scrollPageToTop() { t.$.mainPanel.scroller.scrollTop = 0; } /** * Close drawer if drawerPanel is narrow * @private * @memberOf Main */ function _closeDrawer() { const drawerPanel = document.querySelector('#paperDrawerPanel'); if (drawerPanel.narrow) { drawerPanel.closeDrawer(); } } /** * Set enabled state of Devices menu item * @private * @memberOf Main */ function _setDevicesState() { // disable devices-page if not signed in const idx = _getPageIdx('page-devices'); const el = document.getElementById(t.pages[idx].route); if (el &amp;&amp; app.Utils.isSignedIn()) { el.removeAttribute('disabled'); } else if (el) { el.setAttribute('disabled', 'true'); } } // listen for changes to localStorage addEventListener('storage', _onStorageChanged, false); // listen for changes to highlighted tabs chrome.tabs.onHighlighted.addListener(_onHighlighted); })(); × Search results Close "},"receive_msg.js.html":{"id":"receive_msg.js.html","title":"Source: receive_msg.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: receive_msg.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ (function() { 'use strict'; /** * Handle incoming push messages * @namespace ReceiveMsg */ new ExceptionHandler(); /** * Delay time for fcm message processing * @type {int} * @default * @const * @private * @memberOf ReceiveMsg */ const MESSAGE_WAIT_MILLIS = 500; /** * Get new {@link Device} from {@link GaeMsg} * @param {GaeMsg} data - push data * @returns {Device} a {@link Device} * @private * @memberOf ReceiveMsg */ function _getDevice(data) { return new app.Device(data.dM, data.dSN, data.dOS, data.dN, Date.now()); } /** * Process received push notifications * @param {GaeMsg} data - push message * @private * @memberOf ReceiveMsg */ function _process(data) { const device = _getDevice(data); if (!app.Utils.isSignedIn() || device.isMe()) { // don't handle our messages or if we are signed out return; } app.GA.event(app.GA.EVENT.RECEIVED); try { data.m = decodeURIComponent(data.m); } catch (ex) { // noinspection BadExpressionStatementJS () =&gt; {}; } if (data.act === app.Msg.ACTION.MESSAGE) { // received remote ClipItem app.Devices.add(device); const fav = (data.fav === '1'); // persist app.ClipItem.add(data.m, Date.now(), fav, true, device.getName()) .catch((err) =&gt; { app.GA.error(err.message, 'ReceiveMsg._process'); }); // save to clipboard app.CB.copyToClipboard(data.m); } else if (data.act === app.Msg.ACTION.PING) { // we were pinged app.Devices.add(device); // respond to ping app.Msg.sendPingResponse(data.srcRegId).catch((err) =&gt; { app.Gae.sendMessageFailed(err); }); } else if (data.act === app.Msg.ACTION.PING_RESPONSE) { // someone is around app.Devices.add(device); } else if (data.act === app.Msg.ACTION.DEVICE_ADDED) { // someone new is here app.Devices.add(device); } else if (data.act === app.Msg.ACTION.DEVICE_REMOVED) { // someone went away app.Devices.remove(device); } } /** * Event: Fired when a Web request is about to occur. * Capture the Service Worker request and process messages * @see https://goo.gl/4j4RtY * @param {Object} details - details on the request * @returns {Object} cancel the request * @private * @memberOf ReceiveMsg */ function _onWebRequestBefore(details) { let url = details.url; try { url = decodeURI(url); } catch(ex) { // noinspection BadExpressionStatementJS () =&gt; {}; } const regex = /https:\\/\\/pushy-clipboard\\.github\\.io\\/\\?(.*)/; let text; const matches = url.match(regex); if (matches &amp;&amp; (matches.length &gt; 1)) { text = matches[1]; } if (text) { let dataArray = null; try { dataArray = JSON.parse(text); } catch (ex) { // noinspection BadExpressionStatementJS () =&gt; {}; } if (dataArray) { for (let i = 0; i &lt; dataArray.length; i++) { (function(index) { setTimeout(function() { // slow down message stream _process(dataArray[index]); }, MESSAGE_WAIT_MILLIS); })(i); } } // cancel fake request return {cancel: true}; } } // Listen for web requests chrome.webRequest.onBeforeRequest.addListener(_onWebRequestBefore, { urls: ['https://pushy-clipboard.github.io/*'], }, ['blocking']); })(); × Search results Close "},"sw.js.html":{"id":"sw.js.html","title":"Source: sw.js","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Source: sw.js /* * Copyright (c) 2016-2017, Michael A. Updike All rights reserved. * Licensed under Apache 2.0 * https://opensource.org/licenses/Apache-2.0 * https://goo.gl/wFvBM1 */ (function() { 'use strict'; /** * Service Worker to handle push notifications * @namespace ServiceWorker */ /** * Fake fetch base path * @const * @default * @type {string} * @memberOf ServiceWorker */ const URL_FETCH_BASE = 'https://pushy-clipboard.github.io/?'; /** * Google search base path * @const * @default * @type {string} * @memberOf ServiceWorker */ const URL_SEARCH_BASE = 'https://www.google.com/search?q='; /** * Path to extension's main page * @const * @default * @type {string} * @memberOf ServiceWorker */ const URL_EXT = 'chrome-extension://jemdfhaheennfkehopbpkephjlednffd/html/main.html'; /** @memberOf ServiceWorker */ const TAG_MESSAGE = 'tag-message'; /** @memberOf ServiceWorker */ const TAG_DEVICE = 'tag-device'; /** @memberOf ServiceWorker */ const ACTION_MESSAGE = 'm'; /** @memberOf ServiceWorker */ const ACTION_DEVICE_REMOVED = 'remove_our_device'; /** @memberOf ServiceWorker */ const IC_REMOTE_COPY = '../images/ic_remote_copy.png'; /** @memberOf ServiceWorker */ const IC_ADD_DEVICE = '../images/ic_add_device.png'; /** @memberOf ServiceWorker */ const IC_REMOVE_DEVICE = '../images/ic_remove_device.png'; /** @memberOf ServiceWorker */ const IC_SEARCH = '../images/search-web.png'; // temporary variable to help get all messages at Chrome start-up // normally, can't use globals in service worker, but this is // only used when Chrome first starts up. Pretty sure it won't be // stopped during this time // could use indexedDB if we really have to /** @memberOf ServiceWorker */ let msgArr = []; /** * Service Worker Events * @typedef {Event} SWEvent * @property {Function} waitUntil(Promise) - wait till promise returns * @property {Object} notification - notification * @property {Object} action - notification action * @memberOf ServiceWorker */ /** * Get the name of the Device who sent the message * @param {GaeMsg} data - message object * @returns {string} device name * @memberOf ServiceWorker */ function getDeviceName(data) { let name; if (data.dN) { name = data.dN; } else { name = `${data.dM} - ${data.dSN} - ${data.dOS}`; } return name; } /** * Get the tag for the notification * @param {GaeMsg} data - message object * @returns {string} notification tag * @memberOf ServiceWorker */ function getTag(data) { let tag = TAG_DEVICE; if (data.act === ACTION_MESSAGE) { tag = TAG_MESSAGE; } return tag; } /** * Get the icon for the notification * @param {GaeMsg} data - message object * @returns {string} path to icon * @memberOf ServiceWorker */ function getIcon(data) { let path = IC_ADD_DEVICE; if (data.act === ACTION_MESSAGE) { path = IC_REMOTE_COPY; } else if (data.act === ACTION_DEVICE_REMOVED) { path = IC_REMOVE_DEVICE; } return path; } /** * Send any data attached to a notification to the extension * @param {GaeMsg[]} dataArray - possible array of {@link GaeMsg} objects * @returns {Promise&lt;void&gt;} always resolves */ function processNotificationData(dataArray) { if (dataArray instanceof Array) { return doFakeFetch(dataArray).catch(() =&gt; {}); } else { return Promise.resolve(); } } /** * Send fake GET request so extension can intercept it and get the payload * @see https://bugs.chromium.org/p/chromium/issues/detail?id=452942 * @param {GaeMsg[]} dataArray Array of {@link GaeMsg} objects * @returns {Promise&lt;void&gt;} fails if extension successfully canceled request * @memberOf ServiceWorker */ function doFakeFetch(dataArray) { msgArr = []; let URL_FETCH = URL_FETCH_BASE + JSON.stringify(dataArray); URL_FETCH = encodeURI(URL_FETCH); return fetch(URL_FETCH, {method: 'GET'}); } /** * Event: Received push message * @param {SWEvent} event - the event * @memberOf ServiceWorker */ function onPush(event) { const payload = event.data.json(); const data = payload.data; let body; try { body = decodeURIComponent(data.m); } catch(ex) { // noinspection BadExpressionStatementJS () =&gt; {}; } const tag = getTag(data); const noteOpt = { requireInteraction: (tag === TAG_MESSAGE), body: body, icon: getIcon(data), tag: tag, timestamp: Date.now(), data: null, }; if ((tag === TAG_MESSAGE)) { // add web search action noteOpt.actions = [{ action: 'search', title: 'Search web', icon: IC_SEARCH, }]; } let title = `From ${getDeviceName(data)}`; const promiseChain = clients.matchAll({ includeUncontrolled: true, type: 'window', }).then((clients) =&gt; { for (let i = 0; i &lt; clients.length; i++) { if (clients[i].focused === true) { // we have focus, don't display notification // send data to extension return doFakeFetch([data]).catch(() =&gt; {}); } } return self.registration.getNotifications({ tag: tag, }).then((notifications) =&gt; { if ((notifications.length &gt; 0)) { // append to existing notification noteOpt.renotify = true; const noteData = notifications[0].data; if (noteData instanceof Array) { // data is in the notification // add current and send all to extension noteData.push(data); return processNotificationData(noteData).then(() =&gt; { title += `\\n${noteData.length} new items`; // set data back to item count noteOpt.data = noteData.length; // simulate doFakeFetch cancel error throw new Error('fetch failed'); }); } else { // count of notifications noteOpt.data = notifications[0].data + 1; title = `${noteOpt.data} new items\\n${title}`; } } else { // new notification noteOpt.data = 1; } // send data to extension return doFakeFetch([data]); }).then(() =&gt; { // Extension did not cancel the fake fetch // add data to the notification instead // this is necessary for Chrome OS at startup at least if (tag === TAG_MESSAGE) { msgArr.push(data); if (msgArr.length &gt; 1) { title += `\\n${msgArr.length} new items`; } // shallow copy noteOpt.data = JSON.parse(JSON.stringify(msgArr)); } return self.registration.showNotification(title, noteOpt); }).catch(() =&gt; { // This is the normal outcome of the extension canceling // the fake fetch return self.registration.showNotification(title, noteOpt); }); }); event.waitUntil(promiseChain); } /** * Event: Notification clicked. * @param {SWEvent} event - the event * @memberOf ServiceWorker */ function onNotificationClick(event) { let url = URL_EXT; if (event.action === 'search') { // clicked on search action url = URL_SEARCH_BASE + encodeURIComponent(event.notification.body); } event.notification.close(); const promiseChain = clients.matchAll({ includeUncontrolled: true, type: 'window', }).then((windowClients) =&gt; { return processNotificationData(event.notification.data).then(() =&gt; { for (let i = 0; i &lt; windowClients.length; i++) { const client = windowClients[i]; if ((client.url === url) &amp;&amp; 'focus' in client) { // tab exists, focus it return client.focus(); } } if (clients.openWindow) { // create new tab return clients.openWindow(url); } return Promise.resolve(); }).catch(() =&gt; {}); }); event.waitUntil(promiseChain); } /** * Event: Notification closed - can't open or focus window here. * @param {SWEvent} event - the event * @memberOf ServiceWorker */ function onNotificationClose(event) { event.waitUntil( processNotificationData(event.notification.data).catch(() =&gt; {}) ); } // Listen for install events self.addEventListener('install', (event) =&gt; { event.waitUntil(self.skipWaiting()); }); // Listen for activate events self.addEventListener('activate', (event) =&gt; { event.waitUntil(self.clients.claim()); }); // Listen for push events self.addEventListener('push', onPush); // Listen for notificationclick events self.addEventListener('notificationclick', onNotificationClick); // Listen for notificationclose events self.addEventListener('notificationclose', onNotificationClose); })(); × Search results Close "},"global.html":{"id":"global.html","title":"Global","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Global Type Definitions GaeMsg Data packet sent to server Type: Object Properties: Name Type Description act string type of message m string content of message dM string Device model dSN string Device serial number dOS string Device operating system dN string Device nickname fav string '1' if favorite item (optional) srcRegId string source of ping (optional) Source: messaging_client.js, line 72 GAEvent Google Analytics Event Type: Object Properties: Name Type Description eventCategory string category eventAction string action eventLabel string label noInteraction boolean direct user interaction? Source: analytics.js, line 26 × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Classes Classes ClipItem Device ExceptionHandler Namespaces Alarm CB Devices Fb GA Gae Msg Notify Permissions Reg SW User Utils BG ContentScript Main ReceiveMsg ServiceWorker × Search results Close "},"namespaces.list.html":{"id":"namespaces.list.html","title":"Namespaces","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespaces Classes ClipItem Device ExceptionHandler Namespaces Alarm CB Devices Fb GA Gae Msg Notify Permissions Reg SW User Utils BG ContentScript Main ReceiveMsg ServiceWorker × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Github Pages for Pushy ClipboardMonitor, store, and manage all text placed on the clipboard. Mark favorite items for easy access. Share between your devices using push notifications: Any desktop hardware that supports the Chrome Browser using the Pushy Clipboard Chrome Extension Android phones and tablets using the Pushy Clipboard app Free and advertising free. I write software for fun and hope it benefits others. × Search results Close "},"app.Alarm.html":{"id":"app.Alarm.html","title":"Namespace: Alarm","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Alarm Alarm Manage the chrome.alarm Source: alarm.js, line 13 Members &lt;private, static, constant&gt; ALARM_STORAGE :string Alarm for cleaning up old ClipItem objects Type: string Default Value: storage Source: alarm.js, line 26 Methods &lt;private, static&gt; _onAlarm(alarm) Event: Fired when an alarm has elapsed. Parameters: Name Type Description alarm Object details on alarm Source: alarm.js, line 35 See: https://developer.chrome.com/apps/alarms#event-onAlarm &lt;private, static&gt; _onStorageChanged(event) Event: Fired when item in localStorage changes Parameters: Name Type Description event Event storage event Properties Name Type Description key string storage item that changed Source: alarm.js, line 49 See: https://developer.mozilla.org/en-US/docs/Web/Events/storage &lt;static&gt; deleteOldClipItems() Delete ClipItem objects older than the storageDuration setting Source: alarm.js, line 93 &lt;static&gt; updateAlarms() Set the repeating alarms Source: alarm.js, line 70 × Search results Close "},"app.CB.html":{"id":"app.CB.html","title":"Namespace: CB","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: CB CB Manage the clipboard Source: clipboard.js, line 13 Members &lt;private, static, constant&gt; WAIT_MILLIS :int Delay time for reading from clipboard Type: int Default Value: 250 Source: clipboard.js, line 25 Methods &lt;private, static&gt; _addClipItemFromClipboard() Add a new ClipItem from the Clipboard contents Source: clipboard.js, line 47 &lt;private, static&gt; _onChromeMessage(request, sender, response) → {boolean} Event: Fired when a message is sent from either an extension process (by runtime.sendMessage) or a content script (by tabs.sendMessage). Parameters: Name Type Description request Object details for the message sender Object MessageSender object response function function to call once after processing Source: clipboard.js, line 85 See: https://developer.chrome.com/extensions/runtime#event-onMessage Returns: true if asynchronous Type boolean &lt;private, static&gt; _sendLocalClipItem(clipItem) Send local ClipItem push notification if enabled Parameters: Name Type Description clipItem ClipItem ClipItem to send Source: clipboard.js, line 33 &lt;static&gt; copyToClipboard(text) Copy the given text to the clipboard Parameters: Name Type Description text string text to copy Source: clipboard.js, line 131 &lt;static&gt; getTextFromClipboard() → {string} Get the text from the clipboard Source: clipboard.js, line 114 Returns: text from clipboard Type string × Search results Close "},"app.Devices.html":{"id":"app.Devices.html","title":"Namespace: Devices","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Devices Devices A list of remote Device objects we know about Source: devices.js, line 13 Members &lt;static&gt; _devices :Map A Map of Device objects keyed by their unique names Type: Map Source: devices.js, line 23 Methods &lt;private, static&gt; _load() Get the Device objects from localStorage Source: devices.js, line 47 &lt;private, static&gt; _mapToObj(map) → {Object} Convert Map to Object Parameters: Name Type Description map Map a Map Source: devices.js, line 32 Returns: as Object Type Object &lt;private, static&gt; _onChromeMessage(request, sender, response) → {boolean} Event: Fired when a message is sent from either an extension process (by runtime.sendMessage) or a content script (by tabs.sendMessage). Parameters: Name Type Description request Object details for the message sender Object MessageSender object response function function to call once after processing Source: devices.js, line 98 See: https://developer.chrome.com/extensions/runtime#event-onMessage Returns: true if asynchronous Type boolean &lt;private, static&gt; _onLoad() Event: called when document and resources are loaded Load the Device objects from localStorage Source: devices.js, line 82 &lt;private, static&gt; _save() Save the Device objects to localStorage Source: devices.js, line 68 &lt;static&gt; add(device) Add a new Device Parameters: Name Type Description device Device Device to add Source: devices.js, line 136 &lt;static&gt; clear() Remove all Device objects Source: devices.js, line 164 &lt;static&gt; entries() → {Iterator.&lt;Device&gt;} Get an Iterator on the Devices Source: devices.js, line 127 Returns: Iterator Type Iterator.&lt;Device&gt; &lt;static&gt; remove(device) Remove a Device Parameters: Name Type Description device Device Device to remove Source: devices.js, line 146 &lt;static&gt; removeByName(uniqueName) Remove a Device with the given unique name Parameters: Name Type Description uniqueName string Name of Device to remove Source: devices.js, line 155 × Search results Close "},"app.Fb.html":{"id":"app.Fb.html","title":"Namespace: Fb","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Fb Fb Manage interaction with firebase and its Namespaces Source: firebase.js, line 14 See: https://firebase.google.com/docs/web/setup Members &lt;private, static&gt; _app Firebase app Source: firebase.js, line 33 &lt;private, static&gt; _auth Firebase auth Namespace Source: firebase.js, line 47 &lt;private, static&gt; _messaging Firebase messaging Namespace Source: firebase.js, line 40 &lt;static, constant&gt; ERROR_TOKEN :string Error message for regToken Type: string Default Value: Failed to obtain messaging token. Source: firebase.js, line 25 Methods &lt;private, static&gt; _deleteFirebaseApp() → {Promise.&lt;void&gt;} Delete firebase.app if it exists Source: firebase.js, line 85 Returns: void Type Promise.&lt;void&gt; &lt;private, static&gt; _initializeFirebase(swReg) → {Promise.&lt;void&gt;} Initialize firebase and its Namespaces Parameters: Name Type Description swReg ServiceWorkerRegistration use own ServiceWorker Source: firebase.js, line 56 Returns: void Type Promise.&lt;void&gt; &lt;private, static&gt; _refreshRegToken() Refresh the regToken when firebase changes it Source: firebase.js, line 98 &lt;static&gt; getRegToken() → {Promise.&lt;token&gt;} Get the registration token for fcm Source: firebase.js, line 152 Returns: A registration token for fcm Type Promise.&lt;token&gt; &lt;static&gt; initialize(swReg) → {Promise.&lt;void&gt;} Initialize the firebase libraries Parameters: Name Type Description swReg ServiceWorkerRegistration service worker Source: firebase.js, line 117 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; signIn(token) → {Promise.&lt;Object&gt;} SignIn to firebase Parameters: Name Type Description token string token Source: firebase.js, line 127 Returns: The current firebase user Type Promise.&lt;Object&gt; &lt;static&gt; signOut() → {Promise.&lt;void&gt;} Unregister Service Worker and sign-out of firebase Source: firebase.js, line 141 Returns: Error on reject Type Promise.&lt;void&gt; × Search results Close "},"app.GA.html":{"id":"app.GA.html","title":"Namespace: GA","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: GA GA Manage Google Analytics tracking Source: analytics.js, line 13 Members &lt;static, constant&gt; EVENT :Object Event types Type: Object Properties: Name Type Description INSTALLED GAEvent extension installed UPDATED GAEvent extension updated SENT GAEvent message sent RECEIVED GAEvent message received REGISTERED GAEvent Device registered UNREGISTERED GAEvent Device unregistered Source: analytics.js, line 47 &lt;private, static, constant&gt; TRACKING_ID :string Tracking ID Type: string Default Value: UA-61314754-3 Source: analytics.js, line 24 Methods &lt;private, static&gt; _onLoad() Event: called when document and resources are loaded Initialize Google Analytics Source: analytics.js, line 122 &lt;static&gt; error( [label] [, action]) Send an error Parameters: Name Type Argument Default Description label string &lt;optional&gt; &lt;nullable&gt; null override label action string &lt;optional&gt; &lt;nullable&gt; null override action Source: analytics.js, line 190 &lt;static&gt; event(event [, label] [, action]) Send an event Parameters: Name Type Argument Default Description event GAEvent the event type label string &lt;optional&gt; &lt;nullable&gt; null override label action string &lt;optional&gt; &lt;nullable&gt; null override action Source: analytics.js, line 173 &lt;static&gt; exception(message [, stack]) Send an exception Parameters: Name Type Argument Default Description message string the error message stack string &lt;optional&gt; &lt;nullable&gt; null error stack Source: analytics.js, line 209 &lt;static&gt; page(page) Send a page Parameters: Name Type Description page string page path Source: analytics.js, line 160 × Search results Close "},"app.Gae.html":{"id":"app.Gae.html","title":"Namespace: Gae","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Gae Gae Handle communication with Google App Engine server using Endpoints Source: gae.js, line 14 See: https://cloud.google.com/appengine/docs/standard/java/endpoints/ Members &lt;private, static, constant&gt; DELAY_TIME Delay multiplier for exponential back-off Default Value: 1000 Source: gae.js, line 58 &lt;static&gt; GAE_ROOT :string Root path to our gae server Type: string Source: gae.js, line 89 &lt;private, static, constant&gt; GAE_ROOT_LOCAL Base path of local testing server Default Value: http://localhost:8080/_ah/api Source: gae.js, line 37 &lt;private, static, constant&gt; GAE_ROOT_REMOTE Base path of real gae server Default Value: https://clip-man.appspot.com/_ah/api Source: gae.js, line 26 &lt;private, static, constant&gt; MAX_ATTEMPTS Max retries on 500 errors Default Value: 4 Source: gae.js, line 49 Methods &lt;static&gt; _fetch(url, init) → {Promise.&lt;void&gt;} Fetch with exponential back-off Parameters: Name Type Description url string server Endpoint init Object fetch options Source: gae.js, line 122 Returns: void Type Promise.&lt;void&gt; &lt;private, static&gt; _retryPost(url, token) → {Promise.&lt;void&gt;} Retry call to Endpoint with new token Parameters: Name Type Description url string server Endpoint token string authorization token Source: gae.js, line 75 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; doPost(url, token, retryNewToken) → {Promise.&lt;void&gt;} Perform POST request to server using exponential back-off Parameters: Name Type Description url string server Endpoint token string authorization token retryNewToken boolean if true, retry with new token on error Source: gae.js, line 100 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; getJSON(text) → {JSON|null} Convert text to JSON Parameters: Name Type Description text string text to parse Source: gae.js, line 164 Returns: parsed text, null if not valid JSON Type JSON | null &lt;static&gt; sendMessageFailed(err) Notify listeners that send message failed Parameters: Name Type Description err Error what caused the failure Source: gae.js, line 179 × Search results Close "},"app.Msg.html":{"id":"app.Msg.html","title":"Namespace: Msg","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Msg Msg Send messages to the gae server MessagingEndpoint for delivery Source: messaging_client.js, line 13 Members &lt;static, constant&gt; ACTION :Object Message action Type: Object Default Value: {&quot;MESSAGE&quot;:&quot;m&quot;,&quot;PING&quot;:&quot;ping_others&quot;,&quot;PING_RESPONSE&quot;:&quot;respond_to_ping&quot;,&quot;DEVICE_ADDED&quot;:&quot;add_our_device&quot;,&quot;DEVICE_REMOVED&quot;:&quot;remove_our_device&quot;} Source: messaging_client.js, line 46 &lt;private, static, constant&gt; BODY :Object Message body Type: Object Default Value: {&quot;PING&quot;:&quot;Contacting other devices...&quot;,&quot;PING_RESPONSE&quot;:&quot;Device is online&quot;,&quot;DEVICE_ADDED&quot;:&quot;New device added&quot;,&quot;DEVICE_REMOVED&quot;:&quot;Device removed&quot;} Source: messaging_client.js, line 65 &lt;private, static, constant&gt; MAX_MSG_LEN Max message length. Server may reduce it more Default Value: 4096 Source: messaging_client.js, line 33 &lt;private, static, constant&gt; URL_BASE Base path of MessagingEndpoint Source: messaging_client.js, line 24 Methods &lt;private, static&gt; _getData(action, body) → {GaeMsg} Get the data packet we will send Parameters: Name Type Description action string message type body string message body Source: messaging_client.js, line 93 Returns: data packet Type GaeMsg &lt;static&gt; _getDevice() → {Object} Get portion of Device sent in message Source: messaging_client.js, line 105 Returns: Subset of Device info as object literal Type Object &lt;private, static&gt; _sendMessage(data, notify) → {Promise.&lt;void&gt;} Send message to server for delivery to our Devices Parameters: Name Type Description data GaeMsg data packet notify boolean display notification if true Source: messaging_client.js, line 122 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; sendClipItem(clipItem) → {Promise.&lt;void&gt;} Send clipboard contents as represented by a ClipItem Parameters: Name Type Description clipItem ClipItem contents of clipboard Source: messaging_client.js, line 153 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; sendDeviceAdded() → {Promise.&lt;void&gt;} Send message for adding our Device Source: messaging_client.js, line 174 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; sendDeviceRemoved() → {Promise.&lt;void&gt;} Send message for removing our Device Source: messaging_client.js, line 184 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; sendPing() → {Promise.&lt;void&gt;} Ping our app.Devices Source: messaging_client.js, line 194 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; sendPingResponse(srcRegId) → {Promise.&lt;void&gt;} Respond to a ping from one of our app.Devices Parameters: Name Type Description srcRegId string source of ping Source: messaging_client.js, line 205 Returns: void Type Promise.&lt;void&gt; × Search results Close "},"app.Notify.html":{"id":"app.Notify.html","title":"Namespace: Notify","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Notify Notify Handle display of notifications Source: notify.js, line 13 Members &lt;private, static, constant&gt; ICON :Object Icons Type: Object Default Value: {&quot;LOCAL_COPY&quot;:&quot;/images/ic_local_copy.png&quot;,&quot;ADD_DEVICE&quot;:&quot;/images/ic_add_device.png&quot;,&quot;REMOVE_DEVICE&quot;:&quot;/images/ic_remove_device.png&quot;} Source: notify.js, line 38 &lt;private, static, constant&gt; NOTIFY_SEND :string Send notification type Type: string Default Value: CLIP_MAN_SEND Source: notify.js, line 26 &lt;static&gt; NOTIFY_SEND Send notification type Source: notify.js, line 84 Methods &lt;static&gt; _getIcon(data) → {string} Get the icon for the notification Parameters: Name Type Description data GaeMsg message object Source: notify.js, line 51 Returns: path to icon, null for actions without notifications (ping) Type string &lt;private, static&gt; _onNotificationClicked(id) Event: Fired when the user clicked in a non-button area of the notification. Parameters: Name Type Description id string notification type Source: notify.js, line 71 See: https://developer.chrome.com/apps/notifications#event-onClicked &lt;static&gt; create(type, data) Create and display a notification Parameters: Name Type Description type string notification type (send or receive) data GaeMsg message data Source: notify.js, line 92 &lt;static&gt; onSend() → {boolean} Determine if send notifications are enabled Source: notify.js, line 127 Returns: true if enabled Type boolean &lt;static&gt; showMainTab() Send message to the main tab to focus it. If not found, create it Source: notify.js, line 137 × Search results Close "},"app.Permissions.html":{"id":"app.Permissions.html","title":"Namespace: Permissions","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Permissions Permissions Handle optional permissions Source: permissions.js, line 13 Members &lt;static&gt; ALLOWED Source: permissions.js, line 36 &lt;static, constant&gt; ALLOWED Source: permissions.js, line 28 &lt;static&gt; DENIED Source: permissions.js, line 38 &lt;static, constant&gt; DENIED Source: permissions.js, line 30 &lt;static&gt; NOT_SET Source: permissions.js, line 34 &lt;static, constant&gt; NOT_SET Source: permissions.js, line 26 &lt;static, constant&gt; ORIGINS Source: permissions.js, line 23 &lt;static, constant&gt; PERMISSIONS Source: permissions.js, line 21 Methods &lt;static&gt; contains() → {Promise.&lt;boolean&gt;} Determine if we have the optional permissions Source: permissions.js, line 90 Returns: true if we have permissions Type Promise.&lt;boolean&gt; &lt;static&gt; injectContentScript(tabId) Inject our script into the given tab Parameters: Name Type Description tabId int tab to inject Source: permissions.js, line 155 &lt;static&gt; injectContentScripts() Inject our script into all tabs that match Source: permissions.js, line 130 &lt;static&gt; isAllowed() → {boolean} Has the user allowed the optional permissions Source: permissions.js, line 54 Returns: true if allowed Type boolean &lt;static&gt; notSet() → {boolean} Has use made choice on permissions Source: permissions.js, line 45 Returns: true if allowed or denied Type boolean &lt;static&gt; remove() → {Promise.&lt;boolean&gt;} Remove the optional permissions Source: permissions.js, line 102 Returns: true if removed Type Promise.&lt;boolean&gt; &lt;static&gt; request() → {Promise.&lt;boolean&gt;} Prompt for the optional permissions Source: permissions.js, line 63 Returns: true if permission granted Type Promise.&lt;boolean&gt; × Search results Close "},"app.Reg.html":{"id":"app.Reg.html","title":"Namespace: Reg","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Reg Reg Handle RegistrationEndpoint tasks on the gae server Source: registration_client.js, line 13 Members &lt;private, static, constant&gt; URL_BASE :string Base path of RegistrationEndpoint Type: string Source: registration_client.js, line 25 Methods &lt;private, static&gt; _doCommand(url, errorPrefix) → {Promise.&lt;void&gt;} Send request to server Endpoint Parameters: Name Type Description url string Endpoint path errorPrefix string text prefix to add to Error on reject Source: registration_client.js, line 38 Returns: void Type Promise.&lt;void&gt; &lt;private, static&gt; _onStorageChanged(event) Event: Fired when item in localStorage changes Parameters: Name Type Description event Event storage event Properties Name Type Description key string storage item that changed Source: registration_client.js, line 56 See: https://developer.mozilla.org/en-US/docs/Web/Events/storage &lt;static&gt; register() → {Promise.&lt;void&gt;} Register Device with server Source: registration_client.js, line 94 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; unregister() → {Promise.&lt;void&gt;} Unregister Device with server Source: registration_client.js, line 114 Returns: void Type Promise.&lt;void&gt; × Search results Close "},"app.SW.html":{"id":"app.SW.html","title":"Namespace: SW","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: SW SW Manage lifecycle of our ServiceWorker Source: service_worker.js, line 13 Members &lt;private, static&gt; _swRegistration Our ServiceWorkerRegistration object Source: service_worker.js, line 37 &lt;private, static, constant&gt; SERVICE_WORKER Path to our ServiceWorker Default Value: ../scripts/sw.js Source: service_worker.js, line 30 Methods &lt;private, static&gt; _register() → {Promise.&lt;Object&gt;} Register the Service Worker Note: This can be called if already registered Source: service_worker.js, line 46 Returns: service worker Type Promise.&lt;Object&gt; &lt;private, static&gt; _unsubscribePush() → {Promise.&lt;void&gt;} Unsubscribe from push notifications Source: service_worker.js, line 62 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; initialize() → {Promise.&lt;void&gt;} Initialize the ServiceWorker and firebase Source: service_worker.js, line 79 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; unregister() → {Promise.&lt;void&gt;} Unregister the Service Worker Source: service_worker.js, line 98 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; update() → {Promise.&lt;void&gt;} Update the Service Worker Source: service_worker.js, line 122 Returns: void always resolves Type Promise.&lt;void&gt; × Search results Close "},"app.User.html":{"id":"app.User.html","title":"Namespace: User","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: User User Manage the current user Source: user.js, line 13 Methods &lt;private, static&gt; _onChromeMessage(request, sender, response) → {boolean} Event: Fired when a message is sent from either an extension process (by runtime.sendMessage) or a content script (by tabs.sendMessage). Parameters: Name Type Description request Object details for the message sender Object MessageSender object response function function to call once after processing Source: user.js, line 56 See: https://developer.chrome.com/extensions/runtime#event-onMessage Returns: true if asynchronous Type boolean &lt;private, static&gt; _onSignInChanged(account, signedIn) Event: Fired when signin state changes for an account on the user's profile. Parameters: Name Type Description account Object chrome AccountInfo signedIn boolean true if signedIn Source: user.js, line 29 See: https://developer.chrome.com/apps/identity#event-onSignInChanged &lt;static&gt; addAccess() → {Promise.&lt;void&gt;} Sign in and register Device Source: user.js, line 157 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; cleanup() → {Promise.&lt;void&gt;} Cleanup after user signs out of Browser Source: user.js, line 237 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; getAuthToken(retry) → {Promise.&lt;token&gt;} Get an OAuth2.0 token Parameters: Name Type Description retry boolean if true, retry with new token on error Source: user.js, line 205 See: https://developer.chrome.com/apps/identity#method-getAuthToken Returns: An access token Type Promise.&lt;token&gt; &lt;static&gt; ifCleanup() → {Promise.&lt;void&gt;} Cleanup if user signed-out of Browser Source: user.js, line 164 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; removeAccess() → {Promise.&lt;void&gt;} Unregister Device and sign out Source: user.js, line 187 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; removeCachedAuthToken(token) → {Promise.&lt;void&gt;} Remove Auth token from cache Parameters: Name Type Description token string Auth token Source: user.js, line 249 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; setInfo() → {Promise.&lt;void&gt;} Persist info on current Browser user (may be no-one) Source: user.js, line 259 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; signIn() → {Promise.&lt;void&gt;} SignIn with OAuth 2.0 and firebase Source: user.js, line 119 Returns: void Type Promise.&lt;void&gt; &lt;static&gt; signOut() → {Promise.&lt;void&gt;} Sign-out of firebase Source: user.js, line 140 Returns: void Type Promise.&lt;void&gt; × Search results Close "},"app.Utils.html":{"id":"app.Utils.html","title":"Namespace: Utils","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Utils Utils Misc. utility methods Source: utils.js, line 13 Members &lt;static, constant&gt; MILLIS_IN_DAY :int Number of milliseconds a in day Type: int Source: utils.js, line 37 &lt;static, constant&gt; MIN_IN_DAY :int Number of minutes in a day Type: int Source: utils.js, line 29 Methods &lt;static&gt; allowPush() → {boolean} Has user enabled pushing to app.Devices Source: utils.js, line 171 Returns: true if enabled Type boolean &lt;static&gt; allowReceive() → {boolean} Has user enabled receiving from app.Devices Source: utils.js, line 189 Returns: true if enabled Type boolean &lt;static&gt; get(key) → {JSON|null} Get a JSON parsed value from localStorage Parameters: Name Type Description key string key to get value for Source: utils.js, line 121 Returns: JSON object, null if key does not exist Type JSON | null &lt;static&gt; getChromeVersion() → {int} Get the major Chrome version Source: utils.js, line 63 See: https://goo.gl/2ITMNO Returns: Chrome major version Type int &lt;static&gt; getExtensionName() → {string} Get the extension's name Source: utils.js, line 43 Returns: name of extension Type string &lt;static&gt; getFullChromeVersion() → {string} Get the full Chrome version Source: utils.js, line 74 See: https://goo.gl/2ITMNO Returns: Chrome version Type string &lt;static&gt; getInt(key) → {int} Get integer value from localStorage Parameters: Name Type Description key string key to get value for Source: utils.js, line 149 Returns: value as integer Type int &lt;static&gt; getPlatformOS() → {Promise.&lt;string&gt;} Get the OS as a human readable string Source: utils.js, line 84 Returns: OS name Type Promise.&lt;string&gt; &lt;static&gt; getRelativeTime(time) → {string} Get a date string in time ago format Parameters: Name Type Description time int time since epoch in millis Source: utils.js, line 248 Returns: Relative time format Type string &lt;static&gt; getVersion() → {string} Get the Extension version Source: utils.js, line 52 Returns: Extension version Type string &lt;static&gt; isAutoSend() → {boolean} Has user enabled autoSend option Source: utils.js, line 180 Returns: true if enabled Type boolean &lt;static&gt; isMonitorClipboard() → {boolean} Are we saving clipboard contents Source: utils.js, line 162 Returns: true if enabled Type boolean &lt;static&gt; isRegistered() → {boolean} Are we registered with fcm Source: utils.js, line 207 Returns: true if registered Type boolean &lt;static&gt; isSignedIn() → {boolean} Are we signed in Source: utils.js, line 198 Returns: true if signed in Type boolean &lt;static&gt; isWhiteSpace(str) → {boolean} Determine if a String is null or whitespace only Parameters: Name Type Description str string string to check Source: utils.js, line 238 Returns: true if str is whitespace (or null) Type boolean &lt;static&gt; notRegistered() → {boolean} Are we not registered with fcm Source: utils.js, line 216 Returns: true if not registered Type boolean &lt;static&gt; randomString(len) → {string} Get a random string of the given length Parameters: Name Type Description len int | null length of generated string, 8 if null Source: utils.js, line 260 Returns: a random string Type string &lt;static&gt; set(key, value) JSON stringify and save a value to localStorage Parameters: Name Type Argument Description key string key to set value for value Object &lt;nullable&gt; new value, if null remove item Source: utils.js, line 135 &lt;static&gt; setBadgeText() Set the badge displayed on the extension icon Source: utils.js, line 224 × Search results Close "},"BG.html":{"id":"BG.html","title":"Namespace: BG","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: BG BG The background script for the extension. Note: We can't be an Event Page because we use the chrome.webRequest API Source: background.js, line 12 Members &lt;private, static, constant&gt; DATA_VERSION :int Version of localStorage - update when items are added, removed, changed Type: int Default Value: 2 Source: background.js, line 27 &lt;private, static, constant&gt; DEF_VALUES :Object Default values in localStorage Type: Object Source: background.js, line 42 &lt;private, static, constant&gt; INTRO_TEXT :string Initial ClipItem Type: string Source: background.js, line 73 Methods &lt;private, static&gt; _initializeData() Initialize the data saved in localStorage Source: background.js, line 211 &lt;private, static&gt; _initializeFirebase() → {Promise.&lt;void&gt;} Initialize firebase and Service Worker if signed in Source: background.js, line 256 Returns: void Type Promise.&lt;void&gt; &lt;private, static&gt; _onIconClicked() Event: Fired when a browser action icon is clicked. Source: background.js, line 149 See: https://goo.gl/abVwKu &lt;private, static&gt; _onInstalled(details) Event: Fired when the extension is first installed, when the extension is updated to a new version, and when Chrome is updated to a new version. Parameters: Name Type Description details Object type of event Source: background.js, line 100 See: https://developer.chrome.com/extensions/runtime#event-onInstalled &lt;private, static&gt; _onStartup() Event: Fired when a profile that has this extension installed first starts up Source: background.js, line 133 See: https://developer.chrome.com/extensions/runtime#event-onStartup &lt;private, static&gt; _onStorageChanged(event) Event: Fired when item in localStorage changes Parameters: Name Type Description event Event storage event Properties Name Type Description key string storage item that changed Source: background.js, line 187 See: https://developer.mozilla.org/en-US/docs/Web/Events/storage &lt;private, static&gt; _onTabUpdated(tabId) Event: Fired when a tab is updated. Parameters: Name Type Description tabId int id of tab Source: background.js, line 175 See: https://developer.chrome.com/extensions/tabs#event-onUpdated &lt;private, static&gt; _saveDefaults() Save the Background.DEF_VALUES array to localStorage Source: background.js, line 198 &lt;private, static&gt; _updateData() Update the data saved in localStorage Source: background.js, line 231 × Search results Close "},"ClipItem.html":{"id":"ClipItem.html","title":"Class: ClipItem","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Class: ClipItem ClipItem new ClipItem(text, date, fav, remote, device) Create a new ClipItem Parameters: Name Type Description text string The text of the clip date int Time in milliSecs from epoch fav boolean true if this has been marked as a favorite remote boolean true if this came from a device other than ours device string A String representing the source device Source: clip_item.js, line 22 Members &lt;private, static&gt; _db :Object The Dexie database Type: Object Source: clip_item.js, line 37 See: http://dexie.org/ &lt;static, constant&gt; ERROR_EMPTY_TEXT :string Error indicating that ClipItem text is null or all whitespace Type: string Default Value: Empty text Source: clip_item.js, line 54 &lt;private, static, constant&gt; VERSION :int The Dexie database version Type: int Source: clip_item.js, line 46 Methods &lt;private, static&gt; _deleteOlderThan(time) → {Promise.&lt;boolean&gt;} Delete non-favorite ClipItem objects older than the given time Parameters: Name Type Description time int time in millis since epoch Source: clip_item.js, line 190 Returns: true if items were deleted Type Promise.&lt;boolean&gt; &lt;private, static&gt; _onLoad() Event: called when document and resources are loaded Initialize Dexie Source: clip_item.js, line 208 &lt;static&gt; add(text, date, fav, remote, device) → {Promise.&lt;ClipItem&gt;} Add new ClipItem to storage Parameters: Name Type Description text string The text of the clip date int Time in milliSecs from epoch fav boolean true if this has been marked as a favorite remote boolean true if this came from a device other than ours device string A String representing the source device Source: clip_item.js, line 118 Returns: A new ClipItem Type Promise.&lt;ClipItem&gt; &lt;static&gt; deleteOld() → {Promise.&lt;boolean&gt;} Delete items older than the storageDuration setting Source: clip_item.js, line 166 Returns: true if items were deleted Type Promise.&lt;boolean&gt; &lt;static&gt; isEmpty() → {Promise.&lt;boolean&gt;} Return true is there are no stored ClipItem objects Source: clip_item.js, line 148 Returns: true if no ClipItem objects Type Promise.&lt;boolean&gt; &lt;static&gt; loadAll() → {Promise.&lt;Array&gt;} Return all the ClipItem objects from storage Source: clip_item.js, line 158 Returns: Array of ClipItem objects Type Promise.&lt;Array&gt; &lt;static&gt; remove(keys) → {Promise.&lt;void&gt;} Remove the given keys from storage Parameters: Name Type Description keys Array.&lt;string&gt; array of keys to delete Source: clip_item.js, line 140 Returns: void Type Promise.&lt;void&gt; exists() → {Promise.&lt;boolean&gt;} Determine if ClipItem text exists in storage Source: clip_item.js, line 103 Returns: true if text exists Type Promise.&lt;boolean&gt; getFav() → {boolean} Get fav Source: clip_item.js, line 68 Returns: fav Type boolean save() → {Promise.&lt;string&gt;} Save ourselves to storage Source: clip_item.js, line 92 Returns: primary key it was stored under Type Promise.&lt;string&gt; setDate(date) Set date Parameters: Name Type Description date int millis from epoch Source: clip_item.js, line 60 setFav(fav) Set favorite Parameters: Name Type Description fav boolean is item a favorite Source: clip_item.js, line 76 setRemote(remote) Set remote Parameters: Name Type Description remote boolean true if not from our Device Source: clip_item.js, line 84 × Search results Close "},"ContentScript.html":{"id":"ContentScript.html","title":"Namespace: ContentScript","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: ContentScript ContentScript Content script to monitor clipboard copy and cuts Source: on_copy_cut_content_script.js, line 8 Methods &lt;static&gt; window.onMyCopy() On copy or cut event, send a message to our extension Source: on_copy_cut_content_script.js, line 24 × Search results Close "},"Device.html":{"id":"Device.html","title":"Class: Device","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Class: Device Device new Device(model, sn, os, nickname, lastSeen) Creates a new Device instance. Parameters: Name Type Description model string The model name of a device sn string The serial number (or other descriptor) of a device os string The operating system of a device nickname string The nickname of a device lastSeen int A date in millis from the epoch Source: device.js, line 22 Members &lt;static, constant&gt; MODEL Model key Default Value: dM Source: device.js, line 39 &lt;static, constant&gt; NICKNAME Nickname key Default Value: dN Source: device.js, line 60 &lt;static, constant&gt; OS Operating system key Default Value: dOS Source: device.js, line 53 &lt;static, constant&gt; SN Serial Number key Default Value: dSN Source: device.js, line 46 Methods &lt;static&gt; myModel() → {string} Get model name of our Device Source: device.js, line 114 Returns: model name Type string &lt;static&gt; myName() → {string} Get display name of our Device Source: device.js, line 102 Returns: display name Type string &lt;static&gt; myNickname() → {string} Get nickname of our Device Source: device.js, line 146 Returns: nickname Type string &lt;static&gt; myOS() → {string} Get operating system of our Device Source: device.js, line 130 Returns: operating system Type string &lt;static&gt; mySN() → {string} Get serial number of our Device Source: device.js, line 122 Returns: serial number Type string &lt;static&gt; myUniqueName() → {string} Get unique name of our Device Source: device.js, line 94 Returns: unique name Type string &lt;static&gt; myVersion() → {string} Get os version of our Device Source: device.js, line 138 Returns: operating system version Type string getName() → {string} Get name suitable for display Source: device.js, line 74 Returns: descriptive name of Device Type string getUniqueName() → {string} Get a String that uniquely (hopefully) determines this Device Source: device.js, line 66 Returns: unique name Type string isMe() → {boolean} Determine if this is our Device Source: device.js, line 86 Returns: true if this is our Device Type boolean × Search results Close "},"ExceptionHandler.html":{"id":"ExceptionHandler.html","title":"Class: ExceptionHandler","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Class: ExceptionHandler ExceptionHandler new ExceptionHandler() Log Exceptions with analytics. Include: new ExceptionHandler() at top of every js file Source: exception_handler.js, line 21 × Search results Close "},"Main.html":{"id":"Main.html","title":"Namespace: Main","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: Main Main Script for the main.html page Source: main.js, line 12 Members &lt;static, constant&gt; ANDROID_URI :string Path to the android app in the Play Store Type: string Source: main.js, line 32 &lt;static&gt; devicesPage :element devices-page element Type: element Source: main.js, line 151 &lt;static, constant&gt; EXT_URI :string Path to the extension in the Web Store Type: string Source: main.js, line 23 &lt;static&gt; isMainPage :boolean Is the mainPage being displayed Type: boolean Source: main.js, line 158 &lt;static&gt; pages :Array.&lt;Main.page&gt; Array of Main.page objects Type: Array.&lt;Main.page&gt; Source: main.js, line 74 &lt;static&gt; prevRoute :string Previous route Type: string Source: main.js, line 137 &lt;static, constant&gt; SCREEN_SAVER_URI :string Path to my screen saver extension Type: string Source: main.js, line 42 &lt;static&gt; signInPage :element signin-page element Type: element Source: main.js, line 144 &lt;static, constant&gt; t :Object Auto-binding template Type: Object Source: main.js, line 51 &lt;static&gt; t.avatar :string User photo Type: string Source: main.js, line 130 &lt;static&gt; t.dialogText :string Error dialog text Type: string Source: main.js, line 116 &lt;static&gt; t.dialogTitle :string Error dialog title Type: string Source: main.js, line 109 &lt;static&gt; t.route :string Current route Type: string Source: main.js, line 123 Methods &lt;private, static&gt; _checkPermissions() Display dialog to prompt for accepting optional permissions if it has not been set yet Source: main.js, line 348 &lt;private, static&gt; _closeDrawer() Close drawer if drawerPanel is narrow Source: main.js, line 458 &lt;private, static&gt; _getPageIdx(name) → {int} Get the index into the Main.pages array Parameters: Name Type Description name string Main.page route Source: main.js, line 361 Returns: index into array Type int &lt;private, static&gt; _onChromeMessage(request, sender, response) Event: Fired when a message is sent from either an extension process (by runtime.sendMessage) or a content script (by tabs.sendMessage). Parameters: Name Type Description request Object details for the message sender Object MessageSender object response function function to call once after processing Source: main.js, line 282 See: https://developer.chrome.com/extensions/runtime#event-onMessage &lt;private, static&gt; _onHighlighted(highlightInfo) Event: Fired when the highlighted or selected tabs in a window changes. Parameters: Name Type Description highlightInfo Object info Source: main.js, line 320 See: https://developer.chrome.com/extensions/tabs#event-onHighlighted &lt;private, static&gt; _onStorageChanged(event) Event: Fired when item in localStorage changes Parameters: Name Type Description event Event storage event Properties Name Type Description key string value that changed Source: main.js, line 305 See: https://developer.mozilla.org/en-US/docs/Web/Events/storage &lt;private, static&gt; _scrollPageToTop() Scroll Main Panel to top Source: main.js, line 449 &lt;private, static&gt; _setDevicesState() Set enabled state of Devices menu item Source: main.js, line 470 &lt;private, static&gt; _showDevicesPage(index) Show the devices page Parameters: Name Type Description index int index into Main.pages Source: main.js, line 390 &lt;private, static&gt; _showHelpPage(index) Show the help page Parameters: Name Type Description index int index into Main.pages Source: main.js, line 424 &lt;private, static&gt; _showPermissionsDialog() Show the permissions dialog Source: main.js, line 440 &lt;private, static&gt; _showSettingsPage(index) Show the settings page Parameters: Name Type Description index int index into Main.pages Source: main.js, line 407 &lt;private, static&gt; _showSignInPage(index) Show the signin page Parameters: Name Type Description index int index into Main.pages Source: main.js, line 373 &lt;static&gt; t.computeAvatarDisplay(avatar) → {string} Computed Binding: Determine if avatar should be visible Parameters: Name Type Description avatar string photo url Source: main.js, line 263 Returns: display type Type string &lt;static&gt; t.onAcceptPermissionsClicked() Event: Clicked on accept permissions dialog button Source: main.js, line 236 &lt;static&gt; t.onDenyPermissionsClicked() Event: Clicked on deny permissions dialog button Source: main.js, line 251 &lt;static&gt; t.onNavMenuItemTapped(event) Event: navigation menu selected Parameters: Name Type Description event Event event Source: main.js, line 181 &lt;static&gt; t.onPageAnimation() Event: Main.page finished animating in Source: main.js, line 222 &lt;static&gt; t.onShowErrorDialog(event) Event: display error dialog Parameters: Name Type Description event Event event Source: main.js, line 212 Type Definitions page Manage an html page that is inserted on demand May also be a url link to external site Type: Object Properties: Name Type Description label string label for Nav menu route string element name route to page icon string icon for Nav Menu obj object | null something to be done when selected ready boolean true if html is inserted disabled boolean disabled state of Nav menu divider boolean true for divider before item Source: main.js, line 53 × Search results Close "},"ReceiveMsg.html":{"id":"ReceiveMsg.html","title":"Namespace: ReceiveMsg","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: ReceiveMsg ReceiveMsg Handle incoming push messages Source: receive_msg.js, line 10 Members &lt;private, static, constant&gt; MESSAGE_WAIT_MILLIS :int Delay time for fcm message processing Type: int Default Value: 500 Source: receive_msg.js, line 24 Methods &lt;private, static&gt; _getDevice(data) → {Device} Get new Device from GaeMsg Parameters: Name Type Description data GaeMsg push data Source: receive_msg.js, line 33 Returns: a Device Type Device &lt;private, static&gt; _onWebRequestBefore(details) → {Object} Event: Fired when a Web request is about to occur. Capture the Service Worker request and process messages Parameters: Name Type Description details Object details on the request Source: receive_msg.js, line 98 See: https://goo.gl/4j4RtY Returns: cancel the request Type Object &lt;private, static&gt; _process(data) Process received push notifications Parameters: Name Type Description data GaeMsg push message Source: receive_msg.js, line 43 × Search results Close "},"ServiceWorker.html":{"id":"ServiceWorker.html","title":"Namespace: ServiceWorker","body":" Documentation Namespaces app.Alarmapp.CBapp.Devicesapp.Fbapp.GAapp.Gaeapp.Msgapp.Notifyapp.Permissionsapp.Regapp.SWapp.Userapp.UtilsBGContentScriptMainReceiveMsgServiceWorker Classes ClipItemDeviceExceptionHandler Global Global Namespace: ServiceWorker ServiceWorker Service Worker to handle push notifications Source: sw.js, line 10 Members &lt;static, constant&gt; ACTION_DEVICE_REMOVED Source: sw.js, line 51 &lt;static, constant&gt; ACTION_MESSAGE Source: sw.js, line 49 &lt;static, constant&gt; IC_ADD_DEVICE Source: sw.js, line 56 &lt;static, constant&gt; IC_REMOTE_COPY Source: sw.js, line 54 &lt;static, constant&gt; IC_REMOVE_DEVICE Source: sw.js, line 58 &lt;static, constant&gt; IC_SEARCH Source: sw.js, line 60 &lt;static&gt; msgArr Source: sw.js, line 68 &lt;static, constant&gt; TAG_DEVICE Source: sw.js, line 46 &lt;static, constant&gt; TAG_MESSAGE Source: sw.js, line 44 &lt;static, constant&gt; URL_EXT :string Path to extension's main page Type: string Default Value: chrome-extension://jemdfhaheennfkehopbpkephjlednffd/html/main.html Source: sw.js, line 40 &lt;static, constant&gt; URL_FETCH_BASE :string Fake fetch base path Type: string Default Value: https://pushy-clipboard.github.io/? Source: sw.js, line 22 &lt;static, constant&gt; URL_SEARCH_BASE :string Google search base path Type: string Default Value: https://www.google.com/search?q= Source: sw.js, line 31 Methods &lt;static&gt; doFakeFetch(dataArray) → {Promise.&lt;void&gt;} Send fake GET request so extension can intercept it and get the payload Parameters: Name Type Description dataArray Array.&lt;GaeMsg&gt; Array of GaeMsg objects Source: sw.js, line 145 See: https://bugs.chromium.org/p/chromium/issues/detail?id=452942 Returns: fails if extension successfully canceled request Type Promise.&lt;void&gt; &lt;static&gt; getDeviceName(data) → {string} Get the name of the Device who sent the message Parameters: Name Type Description data GaeMsg message object Source: sw.js, line 85 Returns: device name Type string &lt;static&gt; getIcon(data) → {string} Get the icon for the notification Parameters: Name Type Description data GaeMsg message object Source: sw.js, line 115 Returns: path to icon Type string &lt;static&gt; getTag(data) → {string} Get the tag for the notification Parameters: Name Type Description data GaeMsg message object Source: sw.js, line 101 Returns: notification tag Type string &lt;static&gt; onNotificationClick(event) Event: Notification clicked. Parameters: Name Type Description event SWEvent the event Source: sw.js, line 255 &lt;static&gt; onNotificationClose(event) Event: Notification closed - can't open or focus window here. Parameters: Name Type Description event SWEvent the event Source: sw.js, line 292 &lt;static&gt; onPush(event) Event: Received push message Parameters: Name Type Description event SWEvent the event Source: sw.js, line 157 Type Definitions SWEvent Service Worker Events Type: Event Properties: Name Type Description waitUntil(Promise) function wait till promise returns notification Object notification action Object notification action Source: sw.js, line 70 × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
